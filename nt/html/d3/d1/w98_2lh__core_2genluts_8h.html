<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>test: w98/lh_core/genluts.h File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="../../main.html">Main&nbsp;Page</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a> | <a class="qindex" href="../../globals.html">File&nbsp;Members</a></div>
<h1>genluts.h File Reference</h1>
<p>
<a href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html">Go to the source code of this file.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a0">kAbsoluteCalcNothing</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a1">kAbsoluteCalcBefore</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a2">kAbsoluteCalcAfter</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a3">kAbsShiftBeforeDoNDim</a>&nbsp;&nbsp;&nbsp;FALSE</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a4">kAbsShiftAfterDoNDim</a>&nbsp;&nbsp;&nbsp;TRUE</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a5">FillLuts</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a14">CMMModelHandle</a> CMSession, <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a13">CMProfileRef</a> srcProfile, <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a13">CMProfileRef</a> dstProfile)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16</a> (<a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> theElut, long theSize, long gridPoints, long gridPointsCube)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a7">CreateLinearElut</a> (<a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> theElut, long theSize, long gridPoints, long gridPointsCube)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a8">CreateLinearAlut</a> (<a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a6">UINT8</a> *theAlut, long count)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a9">CreateLinearAlut16</a> (<a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a7">UINT16</a> *theAlut, long aCount)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a10">DoMakeGamutForMonitor</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a11">Extract_MFT_Xlut</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> profileLutPtr, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a> theTag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a12">Extract_MFT_Elut</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> profileLutPtr, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a> theTag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a13">Extract_MFT_Alut</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a> profileLutPtr, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a> theTag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a> theTag)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a15">Extract_TRC_Alut</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a16">Extract_TRC_Elut</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a17">Extract_TRC_Matrix</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a18">ExtractAll_TRC_Luts</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a19">Extract_Gray_Luts</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a20">GetMatrixFromProfile</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a> theTag, double factor)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a21">ExtractAllLuts</a> (<a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> theLutData, <a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a> theCombiData)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a22">Create_LH_ProfileSet</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> CMSession, <a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *profileSet, <a class="el" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a> **newProfileSet)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a23">CreateCombi</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> modelingData, <a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *profileSet, <a class="el" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a> *newProfileSet, <a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a> finalLutData, <a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a21">Boolean</a> createGamutLut)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a>&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a24">PrepareCombiLUTs</a> (<a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a> CMSession, <a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *profileSet)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a2" doxytag="w98/lh_core/genluts.h::kAbsoluteCalcAfter" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define kAbsoluteCalcAfter&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html#l00016">16</a> of file <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html">w98/lh_core/genluts.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="w98/lh_core/genluts.h::kAbsoluteCalcBefore" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define kAbsoluteCalcBefore&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html#l00015">15</a> of file <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html">w98/lh_core/genluts.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a0" doxytag="w98/lh_core/genluts.h::kAbsoluteCalcNothing" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define kAbsoluteCalcNothing&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html#l00014">14</a> of file <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html">w98/lh_core/genluts.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="w98/lh_core/genluts.h::kAbsShiftAfterDoNDim" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define kAbsShiftAfterDoNDim&nbsp;&nbsp;&nbsp;TRUE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html#l00019">19</a> of file <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html">w98/lh_core/genluts.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="w98/lh_core/genluts.h::kAbsShiftBeforeDoNDim" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define kAbsShiftBeforeDoNDim&nbsp;&nbsp;&nbsp;FALSE          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html#l00018">18</a> of file <a class="el" href="../../d4/d0/w98_2lh__core_2genluts_8h-source.html">w98/lh_core/genluts.h</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a22" doxytag="w98/lh_core/genluts.h::Create_LH_ProfileSet" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Create_LH_ProfileSet           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CMSession</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>profileSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a> **&nbsp;</td>
          <td class="mdname" nowrap> <em>newProfileSet</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01999">1999</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00050">Boolean</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a33">cmCantConcatenateError</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00059">CMGetProfileElement()</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00030">CMGetProfileHeader()</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00025">CMProfileRef</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00916">icHeader::colorSpace</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00137">LHConcatProfileSet::count</a>, <a class="el" href="../../d4/d5/w98_2lh__open_2pi__app_8h-source.html#l00171">CMConcatProfileSet::count</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00915">icHeader::deviceClass</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00306">icAbsoluteColorimetric</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00303">icPerceptual</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00304">icRelativeColorimetric</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00305">icSaturation</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00268">icSigAbstractClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00269">icSigColorSpaceClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00248">icSigLabData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00267">icSigLinkClass</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a187a140">icSigNamedColorClass</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a132">icSigNamedData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00163">icSigPreview0Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00164">icSigPreview1Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00165">icSigPreview2Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00247">icSigXYZData</a>, <a class="el" href="../../d1/d1/w98_2lh__core_2genluts_8c.html#a24">InitNamedColorProfileData()</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00054">kDoLab2XYZ</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00053">kDoXYZ2Lab</a>, <a class="el" href="../../d4/d5/w98_2lh__open_2pi__app_8h-source.html#l00170">CMConcatProfileSet::keyIndex</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00136">LHConcatProfileSet::keyIndex</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00052">kNoInfo</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d9/d5/sertl_8c-source.html#l00332">max</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a17">NamedColorProfileOnly</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a16">NoNamedColorProfile</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00917">icHeader::pcs</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00126">LHProfile::pcsConversionMode</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00138">LHConcatProfileSet::prof</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00125">LHProfile::profileSet</a>, <a class="el" href="../../d4/d5/w98_2lh__open_2pi__app_8h-source.html#l00172">CMConcatProfileSet::profileSet</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00128">LHProfile::renderingIntent</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00925">icHeader::renderingIntent</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00039">SINT16</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00072">SmartNewPtrClear()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, and <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00127">LHProfile::usePreviewTag</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l03432">PrepareCombiLUTs()</a>.
<p>
<pre class="fragment"><div>02002 {
02003         <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>                                profHeader;
02004         <a class="code" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a>*     theProfileSet;
02005         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a13">CMProfileRef</a>                    theProfile;
02006         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                                  previousDataColorSpace  = 0x20202020;
02007         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                                  previousConnectionSpace = 0x20202020;
02008         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                                  previousRenderingIntent;
02009         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
02010         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
02011         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                                  elementSize = 0;
02012         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>                                  <a class="code" href="../../d8/d6/sertl_8c.html#a1">max</a>;
02013         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>                                  theSize;
02014         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>                                  index = 0;
02015         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                                  profLoop;
02016         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                                 amIPCS = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02017         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                                  theTag;
02018         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                                  intentIndex = 0;
02019         <span class="keywordtype">long</span>                                    nDeviceCoords;
02020 
02021         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Create_LH_ProfileSet"</span>)
02022         
02023         nDeviceCoords=0;
02024         max = profileSet-&gt;count * 3;
02025         theSize = sizeof (<a class="code" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a>) + sizeof(<a class="code" href="../../d5/d8/structLHProfile.html">LHProfile</a>) * max;
02026         theProfileSet = (<a class="code" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a> *)SmartNewPtrClear(theSize, &amp;aOSerr);
02027         err = aOSerr;
02028         if (err)
02029                 goto CleanupAndExit;
02030                 
02031         theProfileSet-&gt;keyIndex = profileSet-&gt;keyIndex;
02032         
02033         CMSession-&gt;hasNamedColorProf = NoNamedColorProfile;
02034         for ( profLoop = 0; profLoop &lt; profileSet-&gt;count; profLoop++ )
02035         {
02036                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a0">CMGetProfileHeader</a>(profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[profLoop], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
02037                 <span class="keywordflow">if</span> (err)
02038                         <span class="keywordflow">goto</span> CleanupAndExit;
02039                 <span class="keywordflow">if</span> (profLoop == 0){
02040 <span class="preprocessor">#ifdef RenderInt</span>
02041 <span class="preprocessor"></span>                        <span class="keywordflow">if</span>( CMSession-&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> != 0xffffffff ){
02042                                 profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a> = GetActualRenderingIntent( CMSession, profLoop );
02043                         }
02044 <span class="preprocessor">#endif</span>
02045 <span class="preprocessor"></span>                        theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a>;
02046                 }
02047                 <span class="keywordflow">else</span>{
02048 <span class="preprocessor">#ifdef RenderInt</span>
02049 <span class="preprocessor"></span>                        <span class="keywordflow">if</span>( CMSession-&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> != 0xffffffff ){
02050                                 profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a> = GetActualRenderingIntent( CMSession, profLoop );
02051                                 previousRenderingIntent = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a>;
02052                         }
02053 <span class="preprocessor">#endif</span>
02054 <span class="preprocessor"></span>                        theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = previousRenderingIntent;
02055                 }
02056                 <span class="keywordflow">if</span> ( (profLoop &gt; 0) &amp;&amp; (profLoop &lt; profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o1">count</a> - 1) )
02057                 {
02058                         <span class="comment">/*----------------------------------------------------------------------------- color space conv. inbetween? -&gt; ignore the profile*/</span>
02059                         <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a127">icSigColorSpaceClass</a> )
02060                                 <span class="keywordflow">continue</span>;
02061                         <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a187a140">icSigNamedColorClass</a> ){
02062                                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a33">cmCantConcatenateError</a>;
02063                                 <span class="keywordflow">goto</span> CleanupAndExit;
02064                         }
02065                 }
02066                 <span class="comment">/*-------------------------------------------------------------------------------------------------------</span>
02067 <span class="comment">                   if we have non matching pcs color spaces, we have to add a conversion between Lab and XYZ</span>
02068 <span class="comment">                  -------------------------------------------------------------------------------------------------------*/</span>
02069                 <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a187a140">icSigNamedColorClass</a> ){
02070                         err = <a class="code" href="../../d1/d1/w98_2lh__core_2genluts_8c.html#a24">InitNamedColorProfileData</a>( CMSession, profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[profLoop], profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>, &amp;nDeviceCoords );
02071                         <span class="keywordflow">if</span> (err)
02072                                 <span class="keywordflow">goto</span> CleanupAndExit;
02073                         profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a> = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a>;
02074                         <span class="keywordflow">if</span>( profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o1">count</a> == 1 ){
02075                                 CMSession-&gt;hasNamedColorProf = <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a17">NamedColorProfileOnly</a>;
02076                                 <span class="comment">//CMSession-&gt;dataColorSpace = profHeader.colorSpace;</span>
02077                         }
02078                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( profLoop == 0 ){
02079                                 CMSession-&gt;hasNamedColorProf = <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a>;
02080                                 profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a> = <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a132">icSigNamedData</a>;
02081                                 CMSession-&gt;firstColorSpace = <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a132">icSigNamedData</a>;
02082                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a13">kNoInfo</a>; 
02083                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = 0;
02084                                 index++;
02085                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = previousRenderingIntent;
02086                                 previousDataColorSpace = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a>;
02087                         }
02088                         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( profLoop == profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o1">count</a>-1 ){
02089                                 CMSession-&gt;hasNamedColorProf = <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a>;
02090                                 CMSession-&gt;lastColorSpace = <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a132">icSigNamedData</a>;
02091                                 profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a> = <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a132">icSigNamedData</a>;
02092                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a13">kNoInfo</a>; 
02093                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = 0;
02094                                 index++;
02095                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = previousRenderingIntent;
02096                         }
02097                 }
02098                 <span class="keywordflow">if</span> (amIPCS)
02099                 {
02100                         <span class="keywordflow">if</span> (previousConnectionSpace != (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>)
02101                         {
02102                                 <span class="comment">/* insert a XYZ &lt;--&gt; Lab conversion lut */</span>
02103                                 <span class="keywordflow">if</span> (previousConnectionSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a>)
02104                                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a15">kDoLab2XYZ</a>;              <span class="comment">/* create Lab-&gt;XYZ */</span>
02105                                 <span class="keywordflow">else</span>
02106                                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a14">kDoXYZ2Lab</a>;              <span class="comment">/* create XYZ-&gt;Lab */</span>
02107                                 index++;
02108                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = previousRenderingIntent;
02109                         }
02110                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (index &gt; 0)
02111                 {
02112                         <span class="keywordflow">if</span> ( previousDataColorSpace != (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a>)
02113                         {
02114                                 <span class="comment">/* copy old profile for back transform to pcs */</span>
02115                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index-1].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a>;
02116                                 index++;
02117                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> = index;
02118                                 
02119                                 <span class="keywordflow">if</span> (previousConnectionSpace != (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>)profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>)
02120                                 {
02121                                         <span class="comment">/* insert a XYZ &lt;--&gt; Lab conversion lut */</span>
02122                                         <span class="keywordflow">if</span> (previousConnectionSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a>)
02123                                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a15">kDoLab2XYZ</a>;              <span class="comment">/* create Lab-&gt;XYZ */</span>
02124                                         <span class="keywordflow">else</span>
02125                                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a14">kDoXYZ2Lab</a>;              <span class="comment">/* create XYZ-&gt;Lab */</span>
02126                                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = previousRenderingIntent;
02127                                         index++;
02128                                 }
02129                                 
02130                                 previousDataColorSpace  = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a>;
02131                                 previousConnectionSpace = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>;
02132                                 amIPCS = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02133                         }
02134                 }
02135 
02136                 <span class="comment">/*-------------------------------------------------------------------------------------------------------</span>
02137 <span class="comment">                   copy the profile from the original profileSet to the LinoProfileSet</span>
02138 <span class="comment">                  -------------------------------------------------------------------------------------------------------*/</span>
02139                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[profLoop];
02140                 <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a187a140">icSigNamedColorClass</a> ){
02141                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = 0;
02142                 }
02143                 index++;
02144                 <span class="keywordflow">if</span>( intentIndex &lt; CMSession-&gt; nIntents -1 ) intentIndex++;
02145                 <span class="comment">/*-------------------------------------------------------------------------------------------------------</span>
02146 <span class="comment">                   more than 2 profiles -&gt; we have to double the profile in our own LHConcatProfileSet</span>
02147 <span class="comment">                   if we have the profiles  RGB  RGB  RGB  we will now correctly generate: RGB  RGB  rgb  RGB</span>
02148 <span class="comment">                                            XYZ  XYZ  XYZ                                  XYZ  XYZ  xyz  XYZ</span>
02149 <span class="comment">                  -------------------------------------------------------------------------------------------------------*/</span>
02150                 <span class="keywordflow">if</span>( amIPCS &amp;&amp; (profLoop &gt; 0) &amp;&amp; (profLoop &lt; profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o1">count</a> - 1) )
02151                 {
02152                         <span class="comment">/*----------------------------------------------------------------------------- color space conv. inbetween? -&gt; ignore the profile*/</span>
02153                         <span class="keywordflow">if</span> (profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a127">icSigColorSpaceClass</a>)
02154                                 index--;                                                                                <span class="comment">/* not used. behavior changed. see above */</span>
02155                         <span class="keywordflow">else</span>
02156                         {
02157                                 <span class="comment">/*------------------------------------------------------------------------- if the inserted profile contains a preview tag, then use it...*/</span>
02158                                 theProfile = theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index-1].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a>;
02159 
02160                                 <span class="comment">/* Do we check the right preview tag for the intent */</span>
02161                                 <span class="keywordflow">switch</span> (previousRenderingIntent)
02162                                 {
02163                                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>:                              <span class="comment">/* Photographic images */</span>
02164                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a41">icSigPreview0Tag</a>;
02165                                                 <span class="keywordflow">break</span>;
02166                                                 
02167                                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>:    <span class="comment">/* Logo Colors */</span>
02168                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a42">icSigPreview1Tag</a>;
02169                                                 <span class="keywordflow">break</span>;
02170                                                 
02171                                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a144">icSaturation</a>:                              <span class="comment">/* Business graphics */</span>
02172                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a43">icSigPreview2Tag</a>;
02173                                                 <span class="keywordflow">break</span>;
02174                                                 
02175                                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>:    <span class="comment">/* Logo Colors */</span>
02176                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a42">icSigPreview1Tag</a>;
02177                                                 <span class="keywordflow">break</span>;
02178                                                 
02179                                         <span class="keywordflow">default</span>:
02180                                                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
02181                                                 <span class="keywordflow">goto</span> CleanupAndExit;
02182                                 }
02183                                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theProfile, theTag, &amp;elementSize, nil);
02184                                 
02185                                 <span class="keywordflow">if</span> (err == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
02186                                 {
02187                                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index-1].<a class="code" href="../../d5/d8/structLHProfile.html#o2">usePreviewTag</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02188                                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index-1].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a>;      <span class="comment">/* for concate absolute */</span>
02189                                 } <span class="keywordflow">else</span>
02190                                 {
02191                                 <span class="comment">/*------------------------------------------------------------------------- ... else insert the same profile once more */</span>
02192                                         <span class="keywordflow">if</span> ( (profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a126">icSigAbstractClass</a>) &amp;&amp; (profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a125">icSigLinkClass</a>) &amp;&amp; (profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> != <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a187a140">icSigNamedColorClass</a>) ) 
02193                                         {
02194 <span class="preprocessor">#ifdef RenderInt</span>
02195 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span>( CMSession-&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> != 0xffffffff ){
02196                                                         profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a> = GetActualRenderingIntent( CMSession, 0xffffffff );
02197                                                 }
02198 <span class="preprocessor">#endif</span>
02199 <span class="preprocessor"></span>                                                theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[profLoop];
02200                                                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a>;<span class="comment">/* for concate absolute */</span>
02201                                                 index++;
02202                                         }
02203                                 }
02204                                 amIPCS = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;         <span class="comment">/* will force that we stay in PCS... */</span>
02205                         }
02206                 }
02207                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> = index;
02208                 previousDataColorSpace  = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a>;
02209                 previousConnectionSpace = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>;
02210                 previousRenderingIntent = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o13">renderingIntent</a>;
02211 
02212                 <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a125">icSigLinkClass</a> ){
02213                         previousDataColorSpace = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>;
02214                         amIPCS = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02215                 }
02216                 <span class="keywordflow">if</span> (amIPCS)
02217                         amIPCS = (previousDataColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a>) || (previousDataColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a>);
02218                 <span class="keywordflow">else</span>
02219                         amIPCS = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02220         }
02221 
02222 <span class="preprocessor">#ifdef ALLOW_DEVICE_LINK</span>
02223 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( (CMSession)-&gt;appendDeviceLink ){
02224                 <span class="keywordflow">if</span>( previousDataColorSpace == (CMSession)-&gt;lastColorSpace ){
02225                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[profLoop];
02226                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[index].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>;
02227                         index++;
02228                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> = index;
02229                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a0">CMGetProfileHeader</a>(profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[profLoop], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
02230                         <span class="keywordflow">if</span> (err)
02231                                 <span class="keywordflow">goto</span> CleanupAndExit;
02232                         (CMSession)-&gt;lastColorSpace = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>;
02233                 }
02234                 <span class="keywordflow">else</span>{
02235                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a33">cmCantConcatenateError</a>;
02236                         <span class="keywordflow">goto</span> CleanupAndExit;
02237                 }
02238         }
02239         <span class="keywordflow">if</span>( CMSession-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a> || CMSession-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a17">NamedColorProfileOnly</a> ){
02240                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>--;
02241         }
02242         <span class="keywordflow">if</span>( CMSession-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a> ){
02243                 theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>--;                                 <span class="comment">/* remove first profile */</span>
02244                 <span class="keywordflow">for</span>( profLoop=0; profLoop&lt;theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>; profLoop++){
02245                         theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop] = theProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop+1];
02246                 }
02247         }
02248 <span class="preprocessor">#endif</span>
02249 <span class="preprocessor"></span>        *newProfileSet = theProfileSet;
02250         theProfileSet = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
02251         <span class="comment">/* ---------------------------------------------------------------------------------</span>
02252 <span class="comment">            clean up</span>
02253 <span class="comment">           --------------------------------------------------------------------------------- */</span>
02254 CleanupAndExit:
02255         theProfileSet = (<a class="code" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)theProfileSet);
02256 
02257         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Create_LH_ProfileSet"</span>)
02258         return err;
02259 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a23" doxytag="w98/lh_core/genluts.h::CreateCombi" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> CreateCombi           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>modelingData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>profileSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>newProfileSet</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>finalLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a21">Boolean</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>createGamutLut</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l02423">2423</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00029">DoMatrixForCubeStruct::aAlutAdrShift</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00028">DoMatrixForCubeStruct::aAlutAdrSize</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00030">DoMatrixForCubeStruct::aAlutWordSize</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00036">DoMatrixForCubeStruct::aBufferByteCount</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00067">adr_breite_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00062">adr_breite_elut</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00024">DoMatrixForCubeStruct::aElutAdrShift</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00023">DoMatrixForCubeStruct::aElutAdrSize</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00025">DoMatrixForCubeStruct::aElutWordSize</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00043">ALLOC_DATA</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00110">LHCombiData::amIPCS</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00034">DoMatrixForCubeStruct::aPointCount</a>, <a class="el" href="../../d3/d0/lh__core_2dondim_8h-source.html#l00032">DoMatrixForCubeStruct::aus_lut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00068">bit_breite_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00063">bit_breite_elut</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00056">BlockMoveData</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00050">Boolean</a>, <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html#l00035">CalcGridPoints4Cube()</a>, <a class="el" href="../../d9/d2/lh__core_2calcndim_8c-source.html#l00898">CalcNDim_Data16To16_Lut16()</a>, <a class="el" href="../../d9/d2/lh__core_2calcndim_8c-source.html#l00934">CalcNDim_Data16To16_Lut8()</a>, <a class="el" href="../../d9/d2/lh__core_2calcndim_8c-source.html#l00889">CalcNDim_Data16To8_Lut16()</a>, <a class="el" href="../../d9/d2/lh__core_2calcndim_8c-source.html#l00916">CalcNDim_Data16To8_Lut8()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00073">CMCalcParam::clearMask</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a115">cmDraftMode</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00030">CMGetProfileHeader()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00066">CMCalcParam::cmInputBytesPerLine</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00062">CMCalcParam::cmInputColorSpace</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00068">CMCalcParam::cmInputPixelOffset</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00065">CMCalcParam::cmLineCount</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a114">cmNormalMode</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00067">CMCalcParam::cmOutputBytesPerLine</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00063">CMCalcParam::cmOutputColorSpace</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00069">CMCalcParam::cmOutputPixelOffset</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00064">CMCalcParam::cmPixelPerLine</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00043">CMLutParam::colorLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00042">CMLutParam::colorLutWordSize</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00916">icHeader::colorSpace</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00072">CMCalcParam::copyAlpha</a>, <a class="el" href="../../d4/d5/w98_2lh__open_2pi__app_8h-source.html#l00171">CMConcatProfileSet::count</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00137">LHConcatProfileSet::count</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a8">CreateLinearAlut()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a9">CreateLinearAlut16()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a7">CreateLinearElut()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16()</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00037">CUBE_DATA_TYPE</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00038">DATA_2_PTR</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00097">LHCombiData::dataColorSpace</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00915">icHeader::deviceClass</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00045">DISPOSE_IF_DATA</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d6/d6/w98_2lh__core_2frgmnt16_8c-source.html#l00518">DoAbsoluteShiftForPCS_Cube16()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00106">LHCombiData::doCreate_16bit_ALut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00108">LHCombiData::doCreate_16bit_Combi</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00104">LHCombiData::doCreate_16bit_ELut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00105">LHCombiData::doCreate_16bit_XLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00109">LHCombiData::doCreateGamutLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00107">LHCombiData::doCreateLinkProfile</a>, <a class="el" href="../../d1/d0/lh__core_2dondim_8c-source.html#l00130">DoMatrixForCube16()</a>, <a class="el" href="../../d1/d0/lh__core_2dondim_8c-source.html#l00362">DoOnlyMatrixForCube16()</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d3/d0/lh__core_2dondim_8h-source.html#l00027">DoMatrixForCubeStruct::ein_lut</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01762">ExtractAllLuts()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00921">icHeader::flags</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00035">DoMatrixForCubeStruct::gridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00099">LHCombiData::gridPointsCube</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00306">icAbsoluteColorimetric</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00257">icSigCmyData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00256">icSigCmykData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00253">icSigGrayData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00255">icSigHlsData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00254">icSigHsvData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00248">icSigLabData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00267">icSigLinkClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00249">icSigLuvData</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a118">icSigMCH2Data</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a119">icSigMCH3Data</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a120">icSigMCH4Data</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a121">icSigMCH5Data</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a122">icSigMCH6Data</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a123">icSigMCH7Data</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a124">icSigMCH8Data</a>, <a class="el" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a132">icSigNamedData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00252">icSigRgbData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00247">icSigXYZData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00250">icSigYCbCrData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00251">icSigYxyData</a>, <a class="el" href="../../d4/d6/lh__core_2typedefs_8h-source.html#l00070">CMCalcParam::inputData</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00035">CMLutParam::inputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00033">CMLutParam::inputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00034">CMLutParam::inputLutWordSize</a>, <a class="el" href="../../d3/d0/lh__core_2genluts_8h-source.html#l00019">kAbsShiftAfterDoNDim</a>, <a class="el" href="../../d3/d0/lh__core_2genluts_8h-source.html#l00018">kAbsShiftBeforeDoNDim</a>, <a class="el" href="../../d6/d9/lh__open_2general_8h.html#a94a89">kCMMNewLinkProfile</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00054">kDoLab2XYZ</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00053">kDoXYZ2Lab</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00057">kNumOfLab_XYZchannels</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00331">kQualityMask</a>, <a class="el" href="../../d9/d4/lh__core_2stdconv_8c-source.html#l00044">Lab2XYZ_forCube16()</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00041">LOCK_DATA</a>, <a class="el" href="../../d4/d9/lh__core_2routines_8c-source.html#l00147">MakeCube16()</a>, <a class="el" href="../../d1/d1/w98_2lh__core_2genluts_8c.html#a26">MakeSpecialCube16()</a>, <a class="el" href="../../d4/d6/lh__core_2typedefs_8h-source.html#l00197">Matrix2D</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00047">CMLutParam::matrixMFT</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00046">CMLutParam::matrixTRC</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00102">LHCombiData::maxProfileCount</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d4/d6/lh__core_2typedefs_8h-source.html#l00071">CMCalcParam::outputData</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00038">CMLutParam::outputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00036">CMLutParam::outputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00037">CMLutParam::outputLutWordSize</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00917">icHeader::pcs</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00126">LHProfile::pcsConversionMode</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00101">LHCombiData::precision</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00138">LHConcatProfileSet::prof</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00096">LHCombiData::profileClass</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00098">LHCombiData::profileConnectionSpace</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00125">LHProfile::profileSet</a>, <a class="el" href="../../d4/d5/w98_2lh__open_2pi__app_8h-source.html#l00172">CMConcatProfileSet::profileSet</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00103">LHCombiData::profLoop</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00128">LHProfile::renderingIntent</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00100">LHCombiData::renderingIntent</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00031">DoMatrixForCubeStruct::separateAluts</a>, <a class="el" href="../../d4/d0/w98_2lh__core_2dondim_8h-source.html#l00026">DoMatrixForCubeStruct::separateEluts</a>, <a class="el" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00039">SINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00038">SINT8</a>, <a class="el" href="../../d6/d9/heappage_8c.html#a68">sprintf()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00051">Str255</a>, <a class="el" href="../../d3/d0/lh__core_2dondim_8h-source.html#l00037">DoMatrixForCubeStruct::theArr</a>, <a class="el" href="../../d3/d0/lh__core_2dondim_8h-source.html#l00033">DoMatrixForCubeStruct::theMatrix</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00030">UINT8</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00042">UNLOCK_DATA</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00127">LHProfile::usePreviewTag</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00111">LHCombiData::usePreviewTag</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>, and <a class="el" href="../../d9/d4/lh__core_2stdconv_8c-source.html#l00263">XYZ2Lab_forCube16()</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l03432">PrepareCombiLUTs()</a>.
<p>
<pre class="fragment"><div>02428 {
02429         <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>                                profHeader;
02430         <a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>                              aDoNDimTableData;
02431         <a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html">DoMatrixForCubeStruct</a>   aDoMatrixForCubeStruct;
02432         <a class="code" href="../../d7/d3/structCMCalcParam.html">CMCalcParam</a>                     calcParam;
02433                         
02434         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                         err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
02435         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                           aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
02436         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a2">CUBE_DATA_TYPE</a>          inputBuffer      = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
02437         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a2">CUBE_DATA_TYPE</a>          outputBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
02438 
02439         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          loop;
02440         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          theSize;
02441         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          theElutSize;
02442         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          theAlutSize;
02443         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          theCubeSize;
02444         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          theExtraSize=1;
02445         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          theCubePixelCount;
02446         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                          profLoop;
02447         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          savedGridPoints;
02448         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          gridBits;
02449         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          gridPointsCube;
02450         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                         SavedoCreate_16bit_XLut;
02451         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                         SavedoCreate_16bit_ALut;
02452         <span class="keywordtype">void</span>                                    *SaveoutputLut;
02453         <span class="keywordtype">long</span>                            SaveoutputLutEntryCount;
02454         <span class="keywordtype">long</span>                            SaveoutputLutWordSize;
02455         <span class="comment">/*long                          SavegridPointsCube;*/</span>
02456         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                           bIsLabConnection = 0;
02457         
02458         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          numOfElutsCube;
02459 
02460         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                         doSaveElut              = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02461         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                         skipCombi               = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02462         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                         pcsConversion   = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02463         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                         useOutputBuffer;
02464         <a class="code" href="../../d3/d8/structLHCombiData.html">LHCombiData</a>                     theCombiData;
02465         <a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>                      theLutData;     
02466         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                          theBufferByteCount;
02467         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                          aUINT16;
02468         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                          *wordPtr   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
02469         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                           *xlutPtr   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
02470 <span class="preprocessor">#ifdef DoLabSpecial</span>
02471 <span class="preprocessor"></span>        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                          aFac;
02472         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                          i;
02473 <span class="preprocessor">#endif</span>
02474 <span class="preprocessor"></span>
02475 <span class="preprocessor">#ifdef WRITE_LUTS</span>
02476 <span class="preprocessor"></span>        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a22">Str255</a>                          fileString;
02477 <span class="preprocessor">#endif</span>
02478 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02479 <span class="preprocessor"></span>        <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a22">Str255</a>                          lutString;
02480 <span class="preprocessor">#endif</span>
02481 <span class="preprocessor"></span>        <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"CreateCombi"</span>)
02482 
02483         theBufferByteCount = 2;
02484         SetMem(&amp;theCombiData,   sizeof(<a class="code" href="../../d3/d8/structLHCombiData.html">LHCombiData</a>), 0);
02485         SetMem(&amp;theLutData,     sizeof(<a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>),      0);
02486         
02487         theCombiData.amIPCS = FALSE;                    <span class="comment">/* amIPCS has to be FALSE at the beginning of the chain */</span>
02488         if ( modelingData-&gt;hasNamedColorProf == NamedColorProfileAtBegin ){
02489                 theCombiData.amIPCS = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02490         }
02491         <span class="keywordflow">if</span> (newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> == 1)
02492                 skipCombi = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02493         
02494         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a0">CMGetProfileHeader</a>(profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[0], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
02495         <span class="keywordflow">if</span> (err)
02496                 <span class="keywordflow">goto</span> CleanupAndExit;
02497         modelingData-&gt;precision = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)((profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o9">flags</a> &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a2">kQualityMask</a>)&gt;&gt;16);
02498         
02499 <span class="preprocessor">#ifdef RenderInt</span>
02500 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( modelingData-&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> != 0xffffffff ){
02501                 modelingData-&gt;precision = (<span class="keywordtype">short</span>)( modelingData-&gt;dwFlags &amp; 0x0ffff);
02502         }
02503 <span class="preprocessor">#endif</span>
02504 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( modelingData-&gt;precision &gt;= <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a> )            <span class="comment">/* first fix - best mode creates 16-bit luts */</span>
02505         {
02506                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02507                 modelingData-&gt;precision = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>;
02508         }
02509         <span class="keywordflow">else</span>
02510         {
02511       theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02512         }
02513 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02514 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
02515                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  CMMModelHandle-&gt;precision = %d doCreate_16bit_Combi=%d\n"</span>,modelingData-&gt;precision,theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a>);
02516 <span class="preprocessor">#endif</span>
02517 <span class="preprocessor"></span>        
02518         <span class="keywordflow">switch</span> (modelingData-&gt;precision)
02519         {
02520                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a114">cmNormalMode</a>:
02521                         <span class="keywordflow">if</span> (createGamutLut)
02522                                 theCubePixelCount = 87382;
02523                         <span class="keywordflow">else</span>
02524                                 theCubePixelCount = 87382;
02525                                 <span class="keywordflow">if</span>( modelingData-&gt;lookup )theCubePixelCount = 87382;
02526                                 <span class="keywordflow">break</span>;
02527                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a115">cmDraftMode</a>:
02528                         <span class="keywordflow">if</span> (createGamutLut)
02529                                 theCubePixelCount = 5462;
02530                         <span class="keywordflow">else</span>
02531                                 theCubePixelCount = 5462;               <span class="comment">/* 5462 * 3  4 * 8 * 8 * 8 * 8         -&gt;  allow 8^4 */</span>
02532                         <span class="keywordflow">break</span>;
02533                 <span class="keywordflow">case</span> <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>:
02534                         <span class="keywordflow">if</span> (createGamutLut)
02535                                 theCubePixelCount = 87382;
02536                         <span class="keywordflow">else</span>
02537                                 theCubePixelCount = 87382;   <span class="comment">/* 87382 * 3  4 * 16 * 16 * 16 * 16;      -&gt;  allow 16^4  !!! */</span>
02538                         <span class="keywordflow">break</span>;
02539         }
02540         theCubeSize = theCubePixelCount * 3;
02541         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o6">precision</a>                   = modelingData-&gt;precision;
02542         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a>     = newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1;
02543         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a> = (modelingData-&gt;currentCall == <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a94a89">kCMMNewLinkProfile</a>);
02544         <span class="keywordflow">switch</span> ( modelingData-&gt;firstColorSpace )
02545         {
02546                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a>:
02547                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a>:
02548                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a111">icSigLuvData</a>:
02549                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a113">icSigYxyData</a>:
02550                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a>:
02551                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a116">icSigHsvData</a>:
02552                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a117">icSigHlsData</a>:
02553                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a119">icSigCmyData</a>:
02554 <span class="preprocessor">#ifdef PI_Application_h</span>
02555 <span class="preprocessor"></span>                <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a112">icSigYCbCrData</a>:
02556                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a119">icSigMCH3Data</a>:
02557                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a132">icSigNamedData</a>:
02558 <span class="preprocessor">#endif</span>
02559 <span class="preprocessor"></span>                        err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 3, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 3 input channels */</span>
02560                         <span class="keywordflow">break</span>;
02561                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a115">icSigGrayData</a>:
02562                         theCubeSize = 255 ;
02563                         err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 1, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 1 input channel  */</span>
02564                         <span class="keywordflow">break</span>;
02565                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a118">icSigCmykData</a>:
02566                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a120">icSigMCH4Data</a>:
02567                         err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 4, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 4 input channels */</span>
02568                         <span class="keywordflow">break</span>;
02569                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a118">icSigMCH2Data</a>:
02570                         err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 2, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 2 input channels */</span>
02571                         <span class="keywordflow">break</span>;
02572                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a121">icSigMCH5Data</a>:
02573                         err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 5, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 5 input channels */</span>
02574                         <span class="keywordflow">break</span>;
02575                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a122">icSigMCH6Data</a>:
02576                         err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 6, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 6 input channels */</span>
02577                         <span class="keywordflow">break</span>;
02578                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a123">icSigMCH7Data</a>:
02579                         err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 7, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 7 input channels */</span>
02580                         <span class="keywordflow">break</span>;
02581                 <span class="keywordflow">case</span> <a class="code" href="../../d4/d7/mscmm_2lh__core_2profile_8h.html#a186a124">icSigMCH8Data</a>:
02582                         err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a1">CalcGridPoints4Cube</a> ( theCubeSize, 8, &amp;theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, &amp;gridBits );          <span class="comment">/* 8 input channels */</span>
02583                         <span class="keywordflow">break</span>;
02584         }
02585 
02586         bIsLabConnection = 0;
02587         <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a> ){
02588                 <span class="keywordflow">for</span> ( profLoop = 0; profLoop &lt; newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>; profLoop++ ){
02589                         <span class="keywordflow">if</span>( newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> == 0 ){
02590                                 bIsLabConnection |= 1;
02591                         }
02592                 }
02593         }
02594         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a0">CMGetProfileHeader</a>(profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o2">profileSet</a>[profileSet-&gt;<a class="code" href="../../d9/d3/structCMConcatProfileSet.html#o1">count</a>-1], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
02595         <span class="keywordflow">if</span> (err)
02596                 <span class="keywordflow">goto</span> CleanupAndExit;
02597         <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a> ){
02598                 <span class="keywordflow">for</span> ( profLoop = 0; profLoop &lt; newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>; profLoop++ ){
02599                         <span class="keywordflow">if</span>( newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> == 0 &amp;&amp; !createGamutLut ){
02600                                 bIsLabConnection |=2;
02601                         }
02602                 }
02603         }
02604         <span class="comment">/*bIsLabConnection = 0;*/</span>
02605         <span class="keywordflow">if</span>( modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a18">NamedColorProfileAtBegin</a> ){
02606                 bIsLabConnection |=1;
02607                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02608         }
02609                 
02610         <span class="keywordflow">if</span>( modelingData-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a> ){
02611                 bIsLabConnection |=2;
02612                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02613         }
02614                 
02615         <span class="comment">/*--------------------------------------------------------------------------------------------------</span>
02616 <span class="comment">          --                                  loop over all profiles</span>
02617 <span class="comment">          --------------------------------------------------------------------------------------------------*/</span>
02618         <span class="keywordflow">for</span> ( profLoop = 0; profLoop &lt; newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>; profLoop++ )
02619         {
02620 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02621 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
02622                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  &lt; Processing profile #%d &gt;\n"</span>,profLoop);
02623 <span class="preprocessor">#endif</span>
02624 <span class="preprocessor"></span>                theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o8">profLoop</a> = (<span class="keywordtype">long</span>)profLoop;
02625                 <span class="keywordflow">if</span> ( theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a> )
02626                 {
02627                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02628             theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>; <span class="comment">/* UWE 9.2.96 */</span>
02629                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02630                 } <span class="keywordflow">else</span>
02631                 {
02632                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> = ( profLoop != 0 );
02633             theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a> = theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a>;       <span class="comment">/* UWE 9.2.96 */</span>
02634                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> = ( profLoop != newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1 );
02635                 }
02636                 <span class="keywordflow">if</span> (newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a>)
02637                 {
02638                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a> = newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a>;
02639                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a0">CMGetProfileHeader</a>(theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;profHeader);
02640                         <span class="keywordflow">if</span> (err)
02641                                 <span class="keywordflow">goto</span> CleanupAndExit;
02642                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o1">profileClass</a>                       = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a>;
02643                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o2">dataColorSpace</a>             = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a>;
02644                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a>     = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>;
02645                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o5">renderingIntent</a>            = newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a>;
02646                         pcsConversion = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02647                 }
02648                 <span class="keywordflow">else</span>{
02649                         pcsConversion = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02650                 }
02651                 <span class="keywordflow">if</span> ( (err == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>) || pcsConversion ){
02652                         <span class="comment">/*------------------------ free pointers... */</span>
02653                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>     = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
02654                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>    = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
02655                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>     = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
02656                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>    = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>);
02657                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>    = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>);
02658                         
02659                         <span class="keywordflow">if</span> (pcsConversion)
02660                         {
02661                                 <span class="comment">/*</span>
02662 <span class="comment">                                        pcsConversion: we have to convert:     XYZ &lt;--&gt;  Lab</span>
02663 <span class="comment">                                  */</span>
02664                                 <span class="keywordflow">if</span> (inputBuffer == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
02665                                 {
02666                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> = 3;
02667 <span class="preprocessor">#ifdef DoLabSpecial</span>
02668 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span>( modelingData-&gt;firstColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a> || modelingData-&gt;firstColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a111">icSigLuvData</a> ){
02669                                                 err = <a class="code" href="../../d1/d1/w98_2lh__core_2genluts_8c.html#a26">MakeSpecialCube16</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, &amp;theCubeSize, &amp;theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>, &amp;gridBits, &amp;theExtraSize );
02670                                         }
02671                                         <span class="keywordflow">else</span>
02672 <span class="preprocessor">#endif</span>
02673 <span class="preprocessor"></span>                                        err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a4">MakeCube16</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, &amp;theCubeSize, &amp;theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>, &amp;gridBits, &amp;theExtraSize );
02674 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02675 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
02676                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  MakeCube16 -&gt; '%d' bits    cubeSize = %d\n"</span>,gridBits, theCubeSize);
02677 <span class="preprocessor">#endif</span>
02678 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> (err)
02679                                                 <span class="keywordflow">goto</span> CleanupAndExit;
02680                                         theCubePixelCount = theCubeSize / theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02681                                         numOfElutsCube = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02682                                         gridPointsCube = 1&lt;&lt;gridBits;
02683                                         savedGridPoints = gridPointsCube;
02684                                         <span class="keywordflow">if</span>( profLoop == 0 ){
02685                                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = 1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>;
02686                                                 <span class="keywordflow">if</span>( theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> ) theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
02687                                                 <span class="keywordflow">else</span>  theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
02688                                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a> = gridPointsCube; 
02689                                         }
02690 
02691                                 }
02692                                 <span class="keywordflow">else</span>{
02693                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = inputBuffer;
02694                                         inputBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
02695                                 }
02696                                 
02697                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
02698 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02699 <span class="preprocessor"></span>                                ShowCube16( profLoop, <span class="stringliteral">"Lab&lt;-&gt;XYZ"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>), gridPointsCube, theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, 3,VAL_USED_BITS );
02700 <span class="preprocessor">#endif</span>
02701 <span class="preprocessor"></span>                                <span class="comment">/*if ( modelingData-&gt;hasNamedColorProf == NamedColorProfileAtBegin ){</span>
02702 <span class="comment">                                        inputBuffer = theLutData.colorLut;</span>
02703 <span class="comment">                                        theLutData.colorLut = 0;</span>
02704 <span class="comment">                                        QuantizeNamedValues( modelingData, inputBuffer, theCubeSize/theLutData.colorLutInDim );</span>
02705 <span class="comment">                                        theCombiData.amIPCS = TRUE;</span>
02706 <span class="comment">#ifdef DEBUG_OUTPUT</span>
02707 <span class="comment">                                        ShowCube16( profLoop, "after Lab&lt;-&gt;XYZ", createGamutLut, (UINT16 *)DATA_2_PTR(theLutData.colorLut), gridPointsCube, theLutData.colorLutInDim, 3, VAL_USED_BITS );</span>
02708 <span class="comment">#endif</span>
02709 <span class="comment">                                        UNLOCK_DATA(theLutData.colorLut);</span>
02710 <span class="comment">                                        skipCombi = FALSE;</span>
02711 <span class="comment">                                        theLutData.colorLutInDim = kNumOfLab_XYZchannels;</span>
02712 <span class="comment">                                        theLutData.colorLutOutDim = kNumOfLab_XYZchannels;</span>
02713 <span class="comment">                                        continue;</span>
02714 <span class="comment">                                }</span>
02715 <span class="comment">                                else */</span>
02716                                 <span class="keywordflow">if</span> ( newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> == <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a15">kDoLab2XYZ</a> )
02717                                 {
02718 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02719 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
02720                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  doing a PCS conversion:  Lab -&gt; XYZ\n"</span>);
02721 <span class="preprocessor">#endif</span>
02722 <span class="preprocessor"></span>                                        <a class="code" href="../../d1/d6/w98_2lh__core_2stdconv_8h.html#a0">Lab2XYZ_forCube16</a>((UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>), theCubePixelCount);
02723                                 }
02724                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> == <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a14">kDoXYZ2Lab</a> )
02725                                 {
02726 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02727 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
02728                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  doing a PCS conversion:  XYZ -&gt; Lab\n"</span>);
02729 <span class="preprocessor">#endif</span>
02730 <span class="preprocessor"></span>                                        <a class="code" href="../../d1/d6/w98_2lh__core_2stdconv_8h.html#a1">XYZ2Lab_forCube16</a>((UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>), theCubePixelCount);
02731                                 }
02732 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02733 <span class="preprocessor"></span>                                ShowCube16( profLoop, <span class="stringliteral">"after Lab&lt;-&gt;XYZ"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>), gridPointsCube, theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, 3, VAL_USED_BITS );
02734 <span class="preprocessor">#endif</span>
02735 <span class="preprocessor"></span>                                <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
02736                                 skipCombi = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02737                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a17">kNumOfLab_XYZchannels</a>;
02738                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a17">kNumOfLab_XYZchannels</a>;
02739                         } <span class="keywordflow">else</span>
02740                         {
02741                                 <span class="comment">/*</span>
02742 <span class="comment">                                        NO pcsConversion: we are dealing with a profile</span>
02743 <span class="comment">                                  */</span>
02744                                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o14">doCreateGamutLut</a> = createGamutLut &amp;&amp; (profLoop == newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> - 1);
02745                                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o16">usePreviewTag</a>        = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>)newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o2">usePreviewTag</a>;                         
02746                                 
02747                                 <span class="comment">/*----------------------------------------------------------------------------------------------</span>
02748 <span class="comment">                                   get data out of the profile</span>
02749 <span class="comment">                                  ----------------------------------------------------------------------------------------------*/</span>
02750 
02751                                 <span class="keywordflow">if</span>( bIsLabConnection &amp; 1 ){
02752                                         <span class="keywordflow">if</span> ( theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> &gt; 0 ){
02753                                                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> = 0;
02754                                                 SavedoCreate_16bit_XLut = theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a>;
02755                                                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02756                                         }
02757                                 }
02758                                 <span class="keywordflow">if</span>( bIsLabConnection &amp; 2 ){
02759                                         SavedoCreate_16bit_ALut = theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a>;
02760                                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
02761                                 }
02762                                 err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a21">ExtractAllLuts</a> (&amp;theLutData, &amp;theCombiData);
02763                                 <span class="keywordflow">if</span>( newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> == 1 ){
02764                                         gridPointsCube = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>;
02765                                 }
02766 
02767                                 <span class="keywordflow">if</span>( bIsLabConnection &amp; 1 ){
02768                                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> = newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1;
02769                                         <span class="keywordflow">if</span> ( theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> &gt; 0 ){
02770                                                 theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a> = SavedoCreate_16bit_XLut;
02771                                         }
02772                                 }
02773                                 <span class="keywordflow">if</span>( bIsLabConnection &amp; 2 ){
02774                                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> = SavedoCreate_16bit_ALut;
02775                                 }
02776                                 
02777                                 <span class="keywordflow">if</span> (err)
02778                                         <span class="keywordflow">goto</span> CleanupAndExit;
02779                                 <span class="keywordflow">if</span> ( (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> == 0) || (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> == 0))
02780                                 {
02781                                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
02782                                         <span class="keywordflow">goto</span> CleanupAndExit;
02783                                 }
02784                         }
02785 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02786 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugEXASizeInfo) )
02787                         {
02788                                 <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>)
02789                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  Elut = %6d\n"</span>, (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>*theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>*(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a>&gt;8?2:1)));
02790                                 <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>)
02791                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  Xlut colorLutGridPoints = %6d\n       colorLutInDim      = %6d\n       colorLutOutDim     = %6d\n       colorLutWordSize   = %6d\n"</span>,
02792                                                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a>);
02793                                 <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>)
02794                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  Alut = %6d "</span>, (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a>*theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>*(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a>&gt;8?2:1)));
02795                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n"</span>);
02796                         }
02797 <span class="preprocessor">#endif</span>
02798 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)
02799                                 skipCombi = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02800                         <span class="comment">/*----------------------------------------------------------------------------------------------</span>
02801 <span class="comment">                           save first Elut...</span>
02802 <span class="comment">                          ----------------------------------------------------------------------------------------------*/</span>
02803                         <span class="keywordflow">if</span> (doSaveElut) 
02804                         {
02805                                 <span class="keywordflow">if</span> ( skipCombi )
02806                                         savedGridPoints = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>;
02807                                 <span class="keywordflow">else</span>
02808                                 {
02809                                         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> == 1)
02810                                         {
02811                                                 theCubeSize = 255 ;
02812                                         }
02813                                         <span class="comment">/*------------------------create and initialize cube*/</span>
02814 <span class="preprocessor">#ifdef DoLabSpecial</span>
02815 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span>( modelingData-&gt;firstColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a> || modelingData-&gt;firstColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a111">icSigLuvData</a> ){
02816                                                 err = <a class="code" href="../../d1/d1/w98_2lh__core_2genluts_8c.html#a26">MakeSpecialCube16</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, &amp;theCubeSize, &amp;inputBuffer, &amp;gridBits, &amp;theExtraSize );
02817                                         }
02818                                         <span class="keywordflow">else</span>
02819 <span class="preprocessor">#endif</span>
02820 <span class="preprocessor"></span>                                        err = <a class="code" href="../../d6/d0/w98_2lh__core_2routines_8h.html#a4">MakeCube16</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, &amp;theCubeSize, &amp;inputBuffer, &amp;gridBits, &amp;theExtraSize);
02821 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
02822 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
02823                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  MakeCube16 -&gt; '%d' bits    cubeSize = %d\n"</span>,gridBits, theCubeSize);
02824 <span class="preprocessor">#endif</span>
02825 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> (err)
02826                                                 <span class="keywordflow">goto</span> CleanupAndExit;
02827                                         theCubePixelCount = theCubeSize / theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02828                                         numOfElutsCube = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02829                                         gridPointsCube = 1&lt;&lt;gridBits;
02830                                         savedGridPoints = gridPointsCube;
02831                                 }
02832                                 
02833                                 <span class="comment">/*theSize = GETDATASIZE(theLutData.inputLut);   */</span>                      <span class="comment">/* save final ELUT */</span>
02834                                 theSize = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> * theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;                             <span class="comment">/* save final ELUT */</span>
02835                                 <span class="keywordflow">if</span> ( theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> &gt; 8 )
02836                                         theSize *= 2;
02837                                 
02838                                 <span class="keywordflow">if</span>( bIsLabConnection &amp; 1 ){
02839                                         
02840                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theSize+2, &amp;aOSerr);
02841                                         err = aOSerr;
02842                                         <span class="keywordflow">if</span> (err)
02843                                                 <span class="keywordflow">goto</span> CleanupAndExit;
02844                                         
02845                                         <span class="comment">/*------------------------------------------------------------------------------------------ create linear elut*/</span>
02846                                         theElutSize = theSize / theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02847                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
02848                                         <span class="keywordflow">if</span>( theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> || theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a>){
02849                                                 <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>), theElutSize/ sizeof (UINT16), gridPointsCube, 0 );
02850                                                 finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
02851                                         }
02852                                         <span class="keywordflow">else</span>{
02853                                                 <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a7">CreateLinearElut</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>), theElutSize/ sizeof (UINT16), gridPointsCube, 0 );
02854                                                 finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
02855                                         }
02856                                         <span class="keywordflow">for</span> (loop = 0; loop &lt; theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; loop++)
02857                                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>) + loop * theElutSize, theElutSize);
02858                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = theElutSize/<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
02859                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
02860                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>              = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02861                                         bIsLabConnection &amp;= ~1;
02862                                 }
02863                                 <span class="keywordflow">else</span>{
02864                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a>   = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a>;
02865                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>                   = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>;
02866                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>;
02867                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>              = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02868                                         
02869                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theSize+2, &amp;aOSerr);
02870                                         err = aOSerr;
02871                                         <span class="keywordflow">if</span> (err)
02872                                                 <span class="keywordflow">goto</span> CleanupAndExit;
02873                                         
02874                                         <span class="comment">/*------------------------------------------------------------------------------------------ create linear elut*/</span>
02875                                         theElutSize = theSize / theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
02876                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
02877                                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>), theElutSize/ sizeof (UINT16), theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>, 0);
02878                                         <span class="keywordflow">for</span> (loop = 0; loop &lt; theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; loop++)
02879                                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>) + loop * theElutSize, theElutSize);
02880                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = theElutSize/<span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
02881                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
02882                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
02883                                 }
02884                                 doSaveElut = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
02885 <span class="preprocessor">#ifdef DoLabSpecial</span>
02886 <span class="preprocessor"></span>                                <span class="keywordflow">if</span>( (modelingData-&gt;firstColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a> || modelingData-&gt;firstColorSpace == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a111">icSigLuvData</a>) ){
02887                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
02888                                         wordPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> );
02889                                         aFac = (((1&lt;&lt;15)*((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>-1)*(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)gridPointsCube + finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>/2)/
02890                                                         (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> + gridPointsCube/2)/((<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>)gridPointsCube-1);
02891                                         i = finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>/2 - 1;
02892                                         <span class="keywordflow">for</span>( aUINT16 = 0; aUINT16 &lt; (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; aUINT16++){
02893                                                 <span class="keywordflow">for</span>( loop = 0; loop &lt;= (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>)(i+1); loop++){
02894                                                         *wordPtr++ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)((*wordPtr * aFac + (1&lt;&lt;(15-1)) )&gt;&gt;15);
02895                                                 }
02896 
02897                                                 <span class="keywordflow">for</span>( loop = 1; loop &lt;= (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>)i; loop++){
02898                                                         *wordPtr++ = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)((*wordPtr * ((aFac *( i - loop ) + (1&lt;&lt;15) * loop + i/2)/i) + (1&lt;&lt;(15-1)) )&gt;&gt;15);
02899                                                 }
02900                                         }
02901                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
02902                                 }       
02903 <span class="preprocessor">#endif                  </span>
02904 <span class="preprocessor"></span>                        }
02905                         
02906                         <span class="comment">/*----------------------------------------------------------------------------------------------</span>
02907 <span class="comment">                           save last Alut...</span>
02908 <span class="comment">                          ----------------------------------------------------------------------------------------------*/</span>
02909                         <span class="keywordflow">if</span> (profLoop == newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> - 1)
02910                         {
02911                                 <span class="comment">/*theSize = GETDATASIZE(theLutData.outputLut);*/</span>
02912                                 theSize = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> * theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;                           <span class="comment">/* save final ALUT */</span>
02913                                 <span class="keywordflow">if</span> ( theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> &gt; 8 )
02914                                         theSize *= 2;
02915                                 <span class="keywordflow">if</span>( bIsLabConnection &amp; 2 ){
02916                                         SaveoutputLut = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>;
02917                                         SaveoutputLutEntryCount = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a>;
02918                                         SaveoutputLutWordSize = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a>;
02919                                 }
02920                                 <span class="keywordflow">else</span>{
02921                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>;
02922                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a>;
02923                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a>;
02924                                 }
02925                                 finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
02926 
02927                                 theAlutSize = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a22">adr_breite_alut</a>);
02928                 <span class="keywordflow">if</span> (theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a>)<span class="comment">/* UWE 9.2.96*/</span>
02929                                 {
02930                                         theSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);;
02931                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> * theAlutSize * theSize+theSize, &amp;aOSerr);
02932                                         err = aOSerr;
02933                                         <span class="keywordflow">if</span> (err)
02934                                                 <span class="keywordflow">goto</span> CleanupAndExit;
02935                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
02936                                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a9">CreateLinearAlut16</a> ( (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>), theAlutSize);
02937                                         <span class="keywordflow">for</span> (loop = 1; loop &lt; theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; loop++)
02938                                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>) + loop * theAlutSize * <span class="keyword">sizeof</span>(UINT16), theAlutSize * <span class="keyword">sizeof</span>(UINT16));
02939                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
02940                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
02941                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
02942                                 }
02943                                 <span class="keywordflow">else</span>
02944                                 {
02945                                         theSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>);;
02946                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> * theAlutSize * theSize+theSize, &amp;aOSerr);
02947                                         err = aOSerr;
02948                                         <span class="keywordflow">if</span> (err)
02949                                                 <span class="keywordflow">goto</span> CleanupAndExit;
02950                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
02951 
02952                                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a8">CreateLinearAlut</a>( (UINT8*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>), theAlutSize );
02953                                         <span class="keywordflow">for</span> (loop = 1; loop &lt; theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; loop++)
02954                                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>) + loop * theAlutSize, theAlutSize);
02955                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = theAlutSize;
02956                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a23">bit_breite_alut</a>;
02957                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
02958                                         theBufferByteCount = 1;                 <span class="comment">/* last should be Byte ALUT*/</span>
02959                                 }
02960                                 <span class="keywordflow">if</span>( bIsLabConnection &amp; 2 ){
02961                                         bIsLabConnection &amp;= ~2;
02962                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>;
02963                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a>;
02964                                         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a>;
02965                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = SaveoutputLut;
02966                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = SaveoutputLutEntryCount;
02967                                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = SaveoutputLutWordSize;
02968                                 }
02969                         }
02970                         
02971                         <span class="keywordflow">if</span> (skipCombi)
02972                         {
02973                                 <span class="comment">/*=============================================================================================</span>
02974 <span class="comment">                                        we have either only one profile -or- we did do a pcsConversion</span>
02975 <span class="comment">                                  =============================================================================================*/</span>
02976                                 <span class="keywordflow">if</span> (newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> == 1){                 <span class="comment">/* one profile */</span>
02977                                         theSize = 1;
02978                                         theExtraSize = 1;
02979                                         <span class="keywordflow">for</span>( loop=0; loop&lt;(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>-1); ++loop){        <span class="comment">/* Extra Size for Interpolation */</span>
02980                                                 theSize *=theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a> ;
02981                                                 theExtraSize += theSize;
02982                                         }
02983                                         theSize = 1;
02984                                         <span class="keywordflow">for</span>( loop=0; loop&lt;theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; ++loop){
02985                                                 theSize *= theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>;
02986                                         }
02987                                         theSize *= theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
02988 <span class="preprocessor">#ifdef ALLOW_MMX</span>
02989 <span class="preprocessor"></span>                                        theExtraSize++; <span class="comment">/* +1 for MMX 4 Byte access */</span>
02990 <span class="preprocessor">#endif</span>
02991 <span class="preprocessor"></span>                                        theExtraSize *= theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
02992                                         inputBuffer = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(inputBuffer);
02993                                         <span class="keywordflow">if</span>( theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> ){
02994                                                 inputBuffer = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>( (theSize+theExtraSize) * 2, &amp;aOSerr );
02995                                                 err = aOSerr;
02996                                                 <span class="keywordflow">if</span> (err)
02997                                                         <span class="keywordflow">goto</span> CleanupAndExit;
02998 
02999                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03000                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(inputBuffer);
03001                                                 wordPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( inputBuffer );
03002                                                 xlutPtr = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> );
03003                                                 <span class="keywordflow">if</span>( theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> == 8 ){
03004                                                         <span class="keywordflow">for</span>( loop=0; loop&lt;theSize; ++loop){
03005                                                                 aUINT16 = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)xlutPtr[loop];
03006                                                                 wordPtr[loop] = (aUINT16&lt;&lt;8) | aUINT16;
03007                                                         }
03008                                                 }
03009                                                 <span class="keywordflow">else</span>{
03010                                                         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>( xlutPtr, wordPtr, theSize * 2 );
03011                                                 }
03012                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03013                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(inputBuffer);
03014                                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = inputBuffer;
03015                                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 16;
03016                                                 inputBuffer = 0;
03017                                         }
03018                                         <span class="keywordflow">else</span>{
03019                                                 inputBuffer = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>( (theSize+theExtraSize), &amp;aOSerr );
03020                                                 err = aOSerr;
03021                                                 <span class="keywordflow">if</span> (err)
03022                                                         <span class="keywordflow">goto</span> CleanupAndExit;
03023 
03024                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03025                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(inputBuffer);
03026                                                 wordPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( inputBuffer );
03027                                                 xlutPtr = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>( theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> );
03028                                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>( xlutPtr, wordPtr, theSize );
03029                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03030                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(inputBuffer);
03031                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>( theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> );
03032                                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = inputBuffer;
03033                                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 8;
03034                                                 inputBuffer = 0;
03035                                         }
03036 <span class="comment">/*                                      if( theCombiData.doCreate_16bit_Combi ){</span>
03037 <span class="comment">                                                if( theLutData.colorLutWordSize == 8 ){</span>
03038 <span class="comment">                                                        theSize = 1;</span>
03039 <span class="comment">                                                        for( loop=0; loop&lt;theLutData.colorLutInDim; ++loop){</span>
03040 <span class="comment">                                                                theSize *= theLutData.colorLutGridPoints;</span>
03041 <span class="comment">                                                        }</span>
03042 <span class="comment">                                theSize = theSize *  theLutData.colorLutOutDim;</span>
03043 <span class="comment">                                                        inputBuffer = DISPOSE_IF_DATA(inputBuffer);</span>
03044 <span class="comment">                                                        inputBuffer = ALLOC_DATA( theSize * 2+2, &amp;aOSerr );</span>
03045 <span class="comment">                                                        err = aOSerr;</span>
03046 <span class="comment">                                                        if (err)</span>
03047 <span class="comment">                                                                goto CleanupAndExit;</span>
03048 <span class="comment">                                                        </span>
03049 <span class="comment">                                                        LOCK_DATA(theLutData.colorLut);</span>
03050 <span class="comment">                                                        LOCK_DATA(inputBuffer);</span>
03051 <span class="comment">                                                        wordPtr = DATA_2_PTR( inputBuffer );</span>
03052 <span class="comment">                                                        xlutPtr = DATA_2_PTR( theLutData.colorLut );</span>
03053 <span class="comment">                                                        for( loop=0; loop&lt;theSize; ++loop){</span>
03054 <span class="comment">                                                                aUINT16 = (UINT16)xlutPtr[loop];</span>
03055 <span class="comment">                                                                wordPtr[loop] = (aUINT16&lt;&lt;8) | aUINT16;</span>
03056 <span class="comment">                                                        }</span>
03057 <span class="comment">                                                        UNLOCK_DATA(theLutData.colorLut);</span>
03058 <span class="comment">                                                        UNLOCK_DATA(inputBuffer);</span>
03059 <span class="comment">                                                        theLutData.colorLut = inputBuffer;</span>
03060 <span class="comment">                                                        theLutData.colorLutWordSize = 16;</span>
03061 <span class="comment">                                                        inputBuffer = 0;</span>
03062 <span class="comment">                                                }</span>
03063 <span class="comment">                                        }*/</span>
03064                                 }
03065                                 inputBuffer = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(inputBuffer);
03066                                 inputBuffer = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>;
03067                                 <span class="keywordflow">if</span> (inputBuffer){
03068                                         theCubeSize = theCubePixelCount *  theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
03069                     theCubeSize *= theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
03070                                 }
03071                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = 0;
03072                                 <span class="keywordflow">if</span> ( (profLoop == newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a> - 1) &amp;&amp; ( ! theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a>  &amp;&amp; !theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a>) )<span class="comment">/* UWE 9.2.96*/</span>
03073                                         theBufferByteCount = 1;                 <span class="comment">/* last should be Byte ALUT*/</span>
03074 
03075                         } <span class="keywordflow">else</span>
03076                         {
03077                                 <span class="comment">/*=============================================================================================</span>
03078 <span class="comment">                                        create combi</span>
03079 <span class="comment">                                  =============================================================================================*/</span>
03080                                 <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)
03081                                 {
03082                                         <span class="comment">/*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
03083 <span class="comment">                                           the profile contained a matrix/TRC:</span>
03084 <span class="comment">                                          +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/</span>
03085                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03086                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03087                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(inputBuffer);
03088 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03089 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
03090                                         {
03091                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" matrixTRC: calling DoMatrixForCube16  (gridPointsCube = %d   inputBuffer = %d)\n"</span>, gridPointsCube, theCubeSize);
03092                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  theLutData.colorLutGridPoints = %d\n"</span>, theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>);
03093                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"     %f    %f    %f\n     %f    %f    %f\n     %f    %f    %f\n"</span>,
03094                                                                 (*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[0][0],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[0][1],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[0][2],
03095                                                                 (*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[1][0],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[1][1],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[1][2],
03096                                                                 (*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[2][0],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[2][1],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>)[2][2]);
03097                                         }
03098                                         <span class="keywordflow">if</span> ( createGamutLut )
03099                                         {
03100                                                 <span class="keywordflow">if</span> (DebugLutCheck(kDisplayEXAGamut) )
03101                                                 {
03102                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"Gamut-E Lut #%d @ matrixTRC"</span>, profLoop);
03103                                                         DoDisplayLutNew(lutString,&amp;theLutData, 0);
03104                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"Gamut-A Lut #%d @ matrixTRC"</span>, profLoop);
03105                                                         DoDisplayLutNew(lutString,&amp;theLutData, 2);
03106                                                 }
03107                                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (DebugLutCheck(kDebugEXAReal))
03108                                         {
03109                                                 
03110                                                 lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"E Lut #%d @ matrixTRC"</span>, profLoop);
03111                                                 DoDisplayLutNew(lutString,&amp;theLutData, 0);
03112                                                 lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"A Lut #%d @ matrixTRC"</span>, profLoop);
03113                                                 DoDisplayLutNew(lutString,&amp;theLutData, 2);
03114                                         }
03115 <span class="preprocessor">#endif</span>
03116 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03117 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( !createGamutLut )
03118                                         {
03119                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"E Lut #%d @ matrixTRC"</span>, profLoop);
03120                                                 WriteLut2File( fileString,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>, 'ELUT');
03121                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"A Lut #%d @ matrixTRC"</span>, profLoop);
03122                                                 WriteLut2File( fileString,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>, 'ALUT');
03123                                         }
03124 <span class="preprocessor">#endif</span>
03125 <span class="preprocessor"></span>                                        aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o0">aElutAdrSize</a>     = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>;
03126                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o1">aElutAdrShift</a>    = 0;
03127                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o2">aElutWordSize</a>    = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a>;
03128                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o3">separateEluts</a>    = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03129                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o4">ein_lut</a>                  = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03130                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o5">aAlutAdrSize</a>     = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a>;
03131                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o6">aAlutAdrShift</a>    = 0;
03132                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o7">aAlutWordSize</a>    = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a>;
03133                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o8">separateAluts</a>    = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03134                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o9">aus_lut</a>                  = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03135                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o10">theMatrix</a>                = (<a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a15">Matrix2D</a>     *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>;
03136                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o11">aPointCount</a>              = theCubePixelCount;
03137                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o12">gridPoints</a>               = gridPointsCube;
03138                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o13">aBufferByteCount</a> = theBufferByteCount;
03139                                         aDoMatrixForCubeStruct.<a class="code" href="../../d0/d8/structDoMatrixForCubeStruct.html#o14">theArr</a>                   = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a> *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer);
03140 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03141 <span class="preprocessor"></span>                                        ShowCube16( profLoop, <span class="stringliteral">"DoMatrixForCube16"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer), gridPointsCube, numOfElutsCube, 3, VAL_USED_BITS );
03142 <span class="preprocessor">#endif</span>
03143 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03144 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( !createGamutLut )
03145                                         {
03146                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"DoMat4Cube #%d (TRC)"</span>, profLoop);
03147                                                 WriteLut2File( fileString,inputBuffer, 'XLUT');
03148                                         }
03149 <span class="preprocessor">#endif</span>
03150 <span class="preprocessor"></span>                                        <a class="code" href="../../d3/d1/w98_2lh__core_2dondim_8h.html#a1">DoMatrixForCube16</a>( &amp;aDoMatrixForCubeStruct );
03151 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03152 <span class="preprocessor"></span>                                        ShowCube16( profLoop, <span class="stringliteral">"after DoMatrixForCube16"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer), gridPointsCube, numOfElutsCube, 3, 8*theBufferByteCount );
03153 <span class="preprocessor">#endif</span>
03154 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03155 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( !createGamutLut )
03156                                         {
03157                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"after DoMat4Cube #%d (TRC)"</span>, profLoop);
03158                                                 WriteLut2File( fileString,inputBuffer, 'XLUT');
03159                                         }
03160 <span class="preprocessor">#endif</span>
03161 <span class="preprocessor"></span>                                        
03162                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(inputBuffer);
03163                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03164                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03165                                         <span class="comment">/*SETDATASIZE(inputBuffer, theCubePixelCount * theLutData.colorLutOutDim * theBufferByteCount);*/</span>
03166                                 } <span class="keywordflow">else</span>
03167                                 {
03168                                         <span class="comment">/*+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span>
03169 <span class="comment">                                           the profile contained a mft</span>
03170 <span class="comment">                                          +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*/</span>
03171                                         
03172                                         <span class="comment">/*----------------------------------------------------------------------------------------- absolute colorimetry*/</span>
03173                                         <span class="keywordflow">if</span> ( theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a> &amp;&amp; newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a> )
03174                                         {
03175                                                 <span class="comment">/*for concate absolute, make sure this is not done when preview tag exists)*/</span>
03176                                                 <span class="keywordflow">if</span> (!newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o2">usePreviewTag</a>) {
03177                                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(inputBuffer);
03178                                                         err = <a class="code" href="../../d5/d7/w98_2lh__core_2frgmnt16_8c.html#a5">DoAbsoluteShiftForPCS_Cube16</a>( (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer), theCubePixelCount,
03179                                                                                                                    theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, (Boolean)(theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> != icSigLabData), kAbsShiftBeforeDoNDim );
03180                                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(inputBuffer);
03181                                                         <span class="keywordflow">if</span> (err)
03182                                                                 <span class="keywordflow">goto</span> CleanupAndExit;
03183                                                 }
03184                                         }
03185                                         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)
03186                                         {
03187                                                 <span class="comment">/*-----------------------------------------------------------------------------------------</span>
03188 <span class="comment">                                                   the profile contained a mft AND a matrix:</span>
03189 <span class="comment">                                                  -----------------------------------------------------------------------------------------*/</span>
03190                                                 <span class="comment">/*------------------------------------ pcs is Lab -&gt; handle direct (without Elut and Alut) */</span>
03191                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(inputBuffer);
03192 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03193 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
03194                                                 {
03195                                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" matrixMFT: calling DoOnlyMatrixForCube16\n"</span>);
03196                                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"     %f    %f    %f\n     %f    %f    %f\n     %f    %f    %f\n"</span>,
03197                                                                 (*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[0][0],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[0][1],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[0][2],
03198                                                                 (*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[1][0],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[1][1],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[1][2],
03199                                                                 (*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[2][0],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[2][1],(*(Matrix2D *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>)[2][2]);
03200                                                 }
03201 <span class="preprocessor">#endif</span>
03202 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03203 <span class="preprocessor"></span>                                                ShowCube16( profLoop, <span class="stringliteral">"DoOnlyMatrixForCube16 (mft)"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer), gridPointsCube, numOfElutsCube, kNumOfLab_XYZchannels, VAL_USED_BITS );
03204 <span class="preprocessor">#endif</span>
03205 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03206 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span> ( !createGamutLut )
03207                                                 {
03208                                                         fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"DoOnlyMat4Cube #%d (mft)"</span>, profLoop);
03209                                                         WriteLut2File( fileString,inputBuffer, 'XLUT');
03210                                                 }
03211 <span class="preprocessor">#endif</span>
03212 <span class="preprocessor"></span>                                                <a class="code" href="../../d3/d1/w98_2lh__core_2dondim_8h.html#a2">DoOnlyMatrixForCube16</a>( (Matrix2D        *)theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>, (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer), theCubePixelCount, gridPointsCube );
03213 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03214 <span class="preprocessor"></span>                                                ShowCube16( profLoop, <span class="stringliteral">"after DoOnlyMatrixForCube16 (mft)"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer), gridPointsCube, numOfElutsCube, kNumOfLab_XYZchannels, VAL_USED_BITS );
03215 <span class="preprocessor">#endif</span>
03216 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03217 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span> ( !createGamutLut )
03218                                                 {
03219                                                         fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"DoOnlyMat4Cube #%d (mft)"</span>, profLoop);
03220                                                         WriteLut2File( fileString,inputBuffer, 'XLUT');
03221                                                 }
03222 <span class="preprocessor">#endif</span>
03223 <span class="preprocessor"></span>                                                
03224                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(inputBuffer);
03225                                         }
03226                                         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> &gt;= theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> &amp;&amp; theBufferByteCount == 2 )
03227                                         {
03228                                                 outputBuffer = inputBuffer;
03229                                                 useOutputBuffer = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03230                                         } <span class="keywordflow">else</span>
03231                                         {
03232                                                 outputBuffer = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>( (theCubePixelCount + theExtraSize ) * theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> * theBufferByteCount, &amp;aOSerr);
03233                                                 err = aOSerr;
03234                                                 <span class="keywordflow">if</span> (err)
03235                                                         <span class="keywordflow">goto</span> CleanupAndExit;
03236                                                 useOutputBuffer = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03237                                         }
03238                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(inputBuffer);
03239                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(outputBuffer);
03240                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03241                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03242                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03243 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03244 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( createGamutLut )
03245                                         {
03246                                                 <span class="keywordflow">if</span> ( DebugLutCheck(kDisplayEXAGamut) )
03247                                                 {
03248                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"Gamut-E Lut #%d @ DoNDim"</span>, profLoop);
03249                                                         DoDisplayLutNew(lutString,&amp;theLutData, 0);
03250                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"Gamut-A Lut #%d @ DoNDim"</span>, profLoop);
03251                                                         DoDisplayLutNew(lutString,&amp;theLutData, 2);
03252                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"Gamut-X Lut #%d @ DoNDim"</span>, profLoop);
03253                                                         DoDisplayLutNew(lutString, &amp;theLutData,1);
03254                                                 }
03255                                         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (DebugLutCheck(kDebugEXAReal) )
03256                                         {
03257                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"E Lut #%d @ DoNDim"</span>, profLoop);
03258                                                         DoDisplayLutNew(lutString,&amp;theLutData, 0);
03259                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"A Lut #%d @ DoNDim"</span>, profLoop);
03260                                                         DoDisplayLutNew(lutString,&amp;theLutData, 2);
03261                                                         lutString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;lutString[1], <span class="stringliteral">"X Lut #%d @ DoNDim"</span>, profLoop);
03262                                                         DoDisplayLutNew(lutString, &amp;theLutData,1);
03263                                         }
03264 <span class="preprocessor">#endif</span>
03265 <span class="preprocessor"></span>                                        
03266 <span class="preprocessor">#ifdef WRITE_LUTS</span>
03267 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( !createGamutLut )
03268                                         {
03269                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"E Lut #%d @ DoNDim"</span>, profLoop);
03270                                                 WriteLut2File( fileString,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>, 'ELUT');
03271                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"A Lut #%d @ DoNDim"</span>, profLoop);
03272                                                 WriteLut2File( fileString,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>, 'ALUT');
03273                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"X Lut #%d @ DoNDim"</span>, profLoop);
03274                                                 WriteLut2File( fileString,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>, 'XLUT');
03275                                         }
03276 <span class="preprocessor">#endif</span>
03277 <span class="preprocessor"></span>
03278                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o0">cmInputColorSpace</a>             = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a>;
03279                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o1">cmOutputColorSpace</a>    = theBufferByteCount == 1 ? <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a51">cm8PerChannelPacking</a> : <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a150a53">cm16PerChannelPacking</a>;
03280                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o2">cmPixelPerLine</a>                = theCubePixelCount;
03281                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o3">cmLineCount</a>                   = 1;
03282                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a>    = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)*theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
03283                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a>   = theBufferByteCount*theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
03284                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o4">cmInputBytesPerLine</a>   = theCubePixelCount*calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o6">cmInputPixelOffset</a>;
03285                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o5">cmOutputBytesPerLine</a>  = theCubePixelCount*calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o7">cmOutputPixelOffset</a>;
03286 <span class="comment">/*                                      calcParam.cmInputBytesPerPixel  = calcParam.cmInputPixelOffset; */</span>
03287 <span class="comment">/*                                      calcParam.cmOutputBytesPerPixel = calcParam.cmOutputPixelOffset;*/</span>
03288                                         <span class="keywordflow">for</span> (loop = 0; loop&lt;theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; loop++)
03289                                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o8">inputData</a>[loop]       = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer)) + loop * <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>);
03290                                         <span class="keywordflow">for</span> (loop = 0; loop&lt;theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; loop++)
03291                                                 calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o9">outputData</a>[loop]      = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(outputBuffer)) + loop * theBufferByteCount;
03292                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o11">clearMask</a>                             = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03293                                         calcParam.<a class="code" href="../../d7/d3/structCMCalcParam.html#o10">copyAlpha</a>                             = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03294 
03295 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03296 <span class="preprocessor"></span>                                        ShowCube16( profLoop, <span class="stringliteral">"DoNDim"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(inputBuffer), gridPointsCube, numOfElutsCube, theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, VAL_USED_BITS );
03297 <span class="preprocessor">#endif</span>
03298 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03299 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( !createGamutLut )
03300                                         {
03301                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"DoNDim #%d"</span>, profLoop);
03302                                                 WriteLut2File( fileString,inputBuffer, 'XLUT');
03303                                         }
03304 <span class="preprocessor">#endif</span>
03305 <span class="preprocessor"></span>
03306                                         aDoNDimTableData = theLutData;
03307 <span class="preprocessor">#if ! LUTS_ARE_PTR_BASED</span>
03308 <span class="preprocessor"></span>                                        aDoNDimTableData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>       = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.inputLut);
03309                                         aDoNDimTableData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>       = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.colorLut);
03310                                         aDoNDimTableData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>      = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.outputLut);
03311 <span class="preprocessor">#endif</span>
03312 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> (theLutData.colorLutWordSize == 18)          <span class="comment">/*  */</span>
03313                                         {
03314                                                 <span class="keywordflow">if</span> ( theBufferByteCount == 1 )
03315                                                         err = <a class="code" href="../../d1/d4/w98_2lh__core_2calcndim_8h.html#a2">CalcNDim_Data16To8_Lut8</a>(&amp;calcParam, &amp;aDoNDimTableData);
03316                                                 <span class="keywordflow">else</span>
03317                                                         err = <a class="code" href="../../d1/d4/w98_2lh__core_2calcndim_8h.html#a3">CalcNDim_Data16To16_Lut8</a>(&amp;calcParam, &amp;aDoNDimTableData);
03318                                         } <span class="keywordflow">else</span>
03319                                         {
03320                                                 <span class="keywordflow">if</span> ( theBufferByteCount == 1 )
03321                                                         err = <a class="code" href="../../d1/d4/w98_2lh__core_2calcndim_8h.html#a6">CalcNDim_Data16To8_Lut16</a>(&amp;calcParam, &amp;aDoNDimTableData);
03322                                                 <span class="keywordflow">else</span>
03323                                                         err = <a class="code" href="../../d1/d4/w98_2lh__core_2calcndim_8h.html#a7">CalcNDim_Data16To16_Lut16</a>(&amp;calcParam, &amp;aDoNDimTableData);
03324                                         }
03325                                         <span class="keywordflow">if</span> (err)
03326                                                 <span class="keywordflow">goto</span> CleanupAndExit;
03327 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03328 <span class="preprocessor"></span>                                        ShowCube16( profLoop, <span class="stringliteral">"after DoNDim"</span>, createGamutLut, (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(outputBuffer), gridPointsCube, numOfElutsCube, theLutData.colorLutOutDim, 8*theBufferByteCount );
03329 <span class="preprocessor">#endif</span>
03330 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03331 <span class="preprocessor"></span>                                        <span class="keywordflow">if</span> ( !createGamutLut )
03332                                         {
03333                                                 fileString[0] = <a class="code" href="../../d6/d9/heappage_8c.html#a68">sprintf</a>((SINT8*)&amp;fileString[1], <span class="stringliteral">"after DoNDim #%d"</span>, profLoop);
03334                                                 WriteLut2File( fileString,outputBuffer, 'XLUT');
03335                                         }
03336 <span class="preprocessor">#endif</span>
03337 <span class="preprocessor"></span>                                        <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.inputLut);
03338                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.colorLut);
03339                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.outputLut);
03340                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(inputBuffer);
03341                                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(outputBuffer);
03342                                         
03343                                         <span class="comment">/*----------------------------------------------------------------------------------------- absolute colorimetry*/</span>
03344                                         <span class="comment">/*for concate absolute, make sure this IS done when preview tag exists)*/</span>
03345                                         <span class="keywordflow">if</span> (newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o2">usePreviewTag</a> &amp;&amp; newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>) {
03346                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(outputBuffer);
03347                                                 err = <a class="code" href="../../d5/d7/w98_2lh__core_2frgmnt16_8c.html#a5">DoAbsoluteShiftForPCS_Cube16</a>( (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(outputBuffer), theCubePixelCount,
03348                                                                                                                    theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, (Boolean)(theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> != icSigLabData), kAbsShiftAfterDoNDim );
03349                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(outputBuffer);
03350                                                 <span class="keywordflow">if</span> (err)
03351                                                         <span class="keywordflow">goto</span> CleanupAndExit;
03352                                         }
03353                                         <span class="keywordflow">if</span> ( !theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a> &amp;&amp; newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[profLoop].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a> )
03354                                         {
03355                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(outputBuffer);
03356                                                         err = <a class="code" href="../../d5/d7/w98_2lh__core_2frgmnt16_8c.html#a5">DoAbsoluteShiftForPCS_Cube16</a>( (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(outputBuffer), theCubePixelCount,
03357                                                                                                                    theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, (Boolean)(theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> != icSigLabData), kAbsShiftAfterDoNDim );
03358                                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(outputBuffer);
03359                                                 <span class="keywordflow">if</span> (err)
03360                                                         <span class="keywordflow">goto</span> CleanupAndExit;
03361                                         }
03362 
03363                                         <span class="keywordflow">if</span> (useOutputBuffer)
03364                                         {
03365                                                 inputBuffer = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(inputBuffer);
03366                                                 inputBuffer = outputBuffer;
03367                                         } <span class="keywordflow">else</span>
03368                                         {
03369                                                 <span class="comment">/*SETDATASIZE(inputBuffer, theCubePixelCount * theLutData.colorLutOutDim * theBufferByteCount);*/</span>
03370                                                 <span class="comment">/*err = MemError();*/</span>
03371                         <span class="comment">/*inputBuffer = ALLOC_DATA( theCubePixelCount * theLutData.colorLutOutDim * theBufferByteCount, &amp;aOSerr );</span>
03372 <span class="comment">                                                err = aOSerr;</span>
03373 <span class="comment">                                                if (err)</span>
03374 <span class="comment">                                                        goto CleanupAndExit;*/</span>
03375                                         }
03376                                         <span class="comment">/*theCubeSize = GETDATASIZE(inputBuffer)/theBufferByteCount;*/</span>
03377                         theCubeSize = theCubePixelCount * theLutData.colorLutOutDim * theBufferByteCount;
03378                                         outputBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
03379                                 }
03380                         }
03381                 }
03382                 skipCombi = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03383                 <span class="keywordflow">if</span>( profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a125">icSigLinkClass</a> ){
03384                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o2">dataColorSpace</a> = profHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a>;
03385                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03386                 }
03387 
03388                 <span class="keywordflow">if</span> (theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a> &amp;&amp; !pcsConversion)
03389                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a> = (theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o16">usePreviewTag</a> == <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>) || (theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o2">dataColorSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a>) || (theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o2">dataColorSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a>);
03390                 <span class="keywordflow">else</span>
03391                         theCombiData.<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a> = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03392         }
03393 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03394 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
03395                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  &lt;&gt;\n"</span>);
03396 <span class="preprocessor">#endif</span>
03397 <span class="preprocessor"></span>        theLutData.colorLut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.colorLut);
03398         theLutData.colorLut = inputBuffer;
03399         inputBuffer = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
03400 
03401         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = theLutData.colorLut;   theLutData.colorLut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
03402         finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a> = savedGridPoints;
03403         <span class="keywordflow">if</span> ( theBufferByteCount == 1 )
03404                 finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 8;
03405         <span class="keywordflow">else</span>
03406                 finalLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 16;
03407         <span class="comment">/* ---------------------------------------------------------------------------------</span>
03408 <span class="comment">            clean up</span>
03409 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
03410 CleanupAndExit:
03411         inputBuffer                      = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(inputBuffer);
03412         outputBuffer             = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(outputBuffer);
03413         theLutData.inputLut      = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.inputLut);
03414         theLutData.outputLut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.outputLut);
03415         theLutData.colorLut      = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.colorLut);
03416         theLutData.matrixMFT = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(theLutData.matrixMFT);
03417         theLutData.matrixTRC = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(theLutData.matrixTRC);
03418 
03419         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"CreateCombi"</span>)
03420         return err;
03421 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a8" doxytag="w98/lh_core/genluts.h::CreateLinearAlut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void CreateLinearAlut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a6">UINT8</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>theAlut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>count</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l02423">CreateCombi()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01461">Extract_Gray_Luts()</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01057">Extract_TRC_Alut()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a9" doxytag="w98/lh_core/genluts.h::CreateLinearAlut16" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void CreateLinearAlut16           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a7">UINT16</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>theAlut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>aCount</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l02423">CreateCombi()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01461">Extract_Gray_Luts()</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01057">Extract_TRC_Alut()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="w98/lh_core/genluts.h::CreateLinearElut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void CreateLinearElut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theElut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>theSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>gridPoints</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>gridPointsCube</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l02423">CreateCombi()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01461">Extract_Gray_Luts()</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01190">Extract_TRC_Elut()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="w98/lh_core/genluts.h::CreateLinearElut16" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void CreateLinearElut16           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theElut</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>theSize</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>gridPoints</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>long&nbsp;</td>
          <td class="mdname" nowrap> <em>gridPointsCube</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l02423">CreateCombi()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01461">Extract_Gray_Luts()</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01190">Extract_TRC_Elut()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="a10" doxytag="w98/lh_core/genluts.h::DoMakeGamutForMonitor" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> DoMakeGamutForMonitor           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00380">380</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00066">adr_bereich_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00062">adr_breite_elut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00068">bit_breite_alut</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00059">CMGetProfileElement()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00043">CMLutParam::colorLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00042">CMLutParam::colorLutWordSize</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00887">icXYZType::data</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00038">DATA_2_PTR</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00143">icSigBlueColorantTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00156">icSigGreenColorantTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00177">icSigRedColorantTag</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00033">CMLutParam::inputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00034">CMLutParam::inputLutWordSize</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a9">LHCombiDataPtr</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00041">LOCK_DATA</a>, <a class="el" href="../../d0/d6/lh__core_2fragment_8c-source.html#l01334">MakeGamut16or32ForMonitor()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00036">CMLutParam::outputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00037">CMLutParam::outputLutWordSize</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00101">LHCombiData::precision</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00039">SINT16</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00042">UNLOCK_DATA</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01762">ExtractAllLuts()</a>.
<p>
<pre class="fragment"><div>00382 {
00383         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  colorantTags[3];
00384         <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a>               colorantData[3];
00385         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>                  loop;
00386         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err;
00387         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>  elementSize;
00388         
00389         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"DoMakeGamutForMonitor"</span>)
00390         
00391         colorantTags[0] = icSigRedColorantTag;
00392         colorantTags[1] = icSigGreenColorantTag;
00393         colorantTags[2] = icSigBlueColorantTag;
00394         
00395         <span class="comment">/* --------------------------------------------------------------------------------- */</span>
00396         for (loop = 0; loop &lt; 3; loop++)
00397         {
00398                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, colorantTags[loop], &amp;elementSize, nil);
00399                 <span class="keywordflow">if</span> (err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00400                         <span class="keywordflow">goto</span> CleanupAndExit;
00401                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, colorantTags[loop], &amp;elementSize, &amp;colorantData[loop]);
00402 <span class="preprocessor">#ifdef IntelMode</span>
00403 <span class="preprocessor"></span>        SwapLongOffset( &amp;colorantData[loop].base.sig, 0, 4 );
00404         SwapLongOffset( &amp;colorantData[loop], (ULONG)((<span class="keywordtype">char</span>*)&amp;colorantData[0].data.data[0]-(<span class="keywordtype">char</span>*)&amp;colorantData[0]), elementSize );
00405 <span class="preprocessor">#endif</span>
00406 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
00407                         <span class="keywordflow">goto</span> CleanupAndExit;
00408         }
00409         
00410         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o6">precision</a> == <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a> )
00411         {
00412                 err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a13">MakeGamut16or32ForMonitor</a>( &amp;colorantData[0], &amp;colorantData[1], &amp;colorantData[2], theLutData, TRUE );
00413                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>  = 32;
00414         }
00415         <span class="keywordflow">else</span>
00416         {
00417                 err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a13">MakeGamut16or32ForMonitor</a>( &amp;colorantData[0], &amp;colorantData[1], &amp;colorantData[2], theLutData, FALSE);
00418                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>  = 16;
00419         }
00420         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>       = 3;
00421         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>      = 1;
00422         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
00423         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00424         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a21">adr_bereich_alut</a>;
00425         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a23">bit_breite_alut</a>;
00426         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 8;
00427 
00428 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00429 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( DebugLutCheck( kDisplayGamut ) )
00430         {
00431                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
00432                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o6">precision</a> == <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>)
00433                         Show32by32by32GamutXLUT(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>));
00434                 <span class="keywordflow">else</span>
00435                         Show16by16by16GamutXLUT(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>));
00436                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
00437         }
00438 <span class="preprocessor">#endif</span>
00439 <span class="preprocessor"></span>        
00440 CleanupAndExit:
00441 
00442         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"DoMakeGamutForMonitor"</span>)
00443         return err;
00444 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a19" doxytag="w98/lh_core/genluts.h::Extract_Gray_Luts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Extract_Gray_Luts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01461">1461</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00067">adr_breite_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00062">adr_breite_elut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00043">ALLOC_DATA</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00110">LHCombiData::amIPCS</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00766">icCurveType::base</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00068">bit_breite_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00063">bit_breite_elut</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00056">BlockMoveData</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00059">CMGetProfileElement()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00043">CMLutParam::colorLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00042">CMLutParam::colorLutWordSize</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00546">icCurve::count</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a8">CreateLinearAlut()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a9">CreateLinearAlut16()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a7">CreateLinearElut()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16()</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00767">icCurveType::curve</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00547">icCurve::data</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00038">DATA_2_PTR</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00045">DISPOSE_IF_DATA</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00106">LHCombiData::doCreate_16bit_ALut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00108">LHCombiData::doCreate_16bit_Combi</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00104">LHCombiData::doCreate_16bit_ELut</a>, <a class="el" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a5">Fill_inverse_byte_ALUT_from_CurveTag()</a>, <a class="el" href="../../d6/d6/w98_2lh__core_2frgmnt16_8c-source.html#l00070">Fill_inverse_ushort_ALUT_from_CurveTag()</a>, <a class="el" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00099">LHCombiData::gridPointsCube</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00155">icSigGrayTRCTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00248">icSigLabData</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00035">CMLutParam::inputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00033">CMLutParam::inputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00034">CMLutParam::inputLutWordSize</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00041">LOCK_DATA</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00036">LUT_DATA_TYPE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00038">CMLutParam::outputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00036">CMLutParam::outputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00037">CMLutParam::outputLutWordSize</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00098">LHCombiData::profileConnectionSpace</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem()</a>, <a class="el" href="../../d1/d1/w98_2lh__core_2genluts_8c.html#a11">SetMem16()</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00760">icTagBase::sig</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00039">SINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00038">SINT8</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00030">UINT8</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00042">UNLOCK_DATA</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01762">ExtractAllLuts()</a>.
<p>
<pre class="fragment"><div>01463 {
01464         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01465         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01466         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   theElut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01467         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   theXlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01468         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   theAlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01469         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  theElutSize;
01470         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  theAlutSize;
01471         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  theXlutSize;
01472         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  loop;
01473         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  elementSize;
01474         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>*                  bytePtr            = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01475         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*                 wordPtr            = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01476         <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>*    pCurveTag          = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01477         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  theSize;
01478         
01479         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Extract_Gray_Luts"</span>)
01480         
01481         theLutData-&gt;colorLutGridPoints = 2;
01482         
01483         if (theCombiData-&gt;amIPCS)
01484         {
01485                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> = 3;
01486                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> = 1;
01487         } <span class="keywordflow">else</span>
01488         {
01489                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> = 1;
01490                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> = 3;
01491         }
01492         
01493         <span class="keywordflow">if</span> (err)
01494                 <span class="keywordflow">goto</span> CleanupAndExit;
01495 
01496         <span class="comment">/* --------------------------------------------------------------------------------- get tag data */</span>
01497         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, icSigGrayTRCTag, &amp;elementSize, nil);
01498         <span class="keywordflow">if</span> (err)
01499                 <span class="keywordflow">goto</span> CleanupAndExit;
01500         pCurveTag = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(elementSize, &amp;aOSerr);
01501         err = aOSerr;
01502         <span class="keywordflow">if</span> (err)
01503                 <span class="keywordflow">goto</span> CleanupAndExit;
01504         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, icSigGrayTRCTag, &amp;elementSize, pCurveTag);
01505 <span class="preprocessor">#ifdef IntelMode</span>
01506 <span class="preprocessor"></span>    SwapLongOffset( &amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o0">base</a>.<a class="code" href="../../d6/d4/structicTagBase.html#o0">sig</a>, 0, 4 );
01507     SwapLong( &amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o0">count</a> );
01508     SwapShortOffset( pCurveTag, (ULONG)((SINT8*)&amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o1">data</a>[0]-(SINT8*)pCurveTag), elementSize );
01509 <span class="preprocessor">#endif</span>
01510 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (err)
01511                 <span class="keywordflow">goto</span> CleanupAndExit;
01512 
01513         <span class="comment">/* </span>
01514 <span class="comment">                                                                                                        X l u t</span>
01515 <span class="comment">           */</span>
01516         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a> )
01517         {
01518                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)                       <span class="comment">/*------------------------------------------------ Lab -&gt; Gray */</span>
01519                 {
01520                         theXlutSize = ((1 &lt;&lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>)+1 ) * (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>); <span class="comment">/*+1=Extra Size for Interpolatio UK13.8.96*/</span>
01521                         theXlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theXlutSize + <span class="keyword">sizeof</span> (UINT16), &amp;aOSerr);
01522                         err = aOSerr;
01523                         <span class="keywordflow">if</span> (err)
01524                                 <span class="keywordflow">goto</span> CleanupAndExit;
01525                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theXlut);
01526                         wordPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theXlut);
01527                         *(wordPtr    )  = 0x0000;
01528                         *(wordPtr + 1)  = 0x0000;
01529                         *(wordPtr + 2)  = 0x0000;
01530                         *(wordPtr + 3)  = 0x0000;
01531                         *(wordPtr + 4)  = 0xffff;
01532                         *(wordPtr + 5)  = 0xffff;
01533                         *(wordPtr + 6)  = 0xffff;
01534                         *(wordPtr + 7)  = 0xffff;
01535                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theXlut);
01536                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 16;
01537                 } <span class="keywordflow">else</span>                                                          <span class="comment">/*------------------------------------------------ Gray -&gt; Lab */</span>
01538                 {
01539                         theXlutSize = (1 &lt;&lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> ) * (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01540                         theXlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theXlutSize + <span class="keyword">sizeof</span> (UINT16), &amp;aOSerr);
01541                         err = aOSerr;
01542                         <span class="keywordflow">if</span> (err)
01543                                 <span class="keywordflow">goto</span> CleanupAndExit;
01544                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theXlut);
01545                         wordPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theXlut);
01546                         *(wordPtr    )  = 0x0000;
01547                         *(wordPtr + 1)  = 0x0000;
01548                         *(wordPtr + 2)  = 0x0000;
01549                         *(wordPtr + 3)  = 0xffff;
01550                         *(wordPtr + 4)  = 0xffff;
01551                         *(wordPtr + 5)  = 0xffff;
01552                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theXlut);
01553                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 16;
01554                 }
01555         } <span class="keywordflow">else</span>
01556         {
01557                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)                       <span class="comment">/*------------------------------------------------ XYZ -&gt; Gray */</span>
01558                 {
01559                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a> = 3;
01560                         theXlutSize = (9 * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> ) * (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01561                         theXlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theXlutSize + 7*<span class="keyword">sizeof</span> (UINT16), &amp;aOSerr);
01562                         err = aOSerr;
01563                         <span class="keywordflow">if</span> (err)
01564                                 <span class="keywordflow">goto</span> CleanupAndExit;
01565                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theXlut);
01566                         wordPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theXlut);
01567                         <span class="keywordflow">for</span> (loop = 0; loop &lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>; loop ++)
01568                         {
01569                                 *wordPtr++  = 0x0000;
01570                                 *wordPtr++  = 0x0000;
01571                                 *wordPtr++  = 0x0000;
01572                                 *wordPtr++  = 0xffff;
01573                                 *wordPtr++  = 0xffff;
01574                                 *wordPtr++  = 0xffff;
01575                                 *wordPtr++  = 0xffff;
01576                                 *wordPtr++  = 0xffff;
01577                                 *wordPtr++  = 0xffff;
01578                         }
01579                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theXlut);
01580                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 16;
01581                 } <span class="keywordflow">else</span>                                                          <span class="comment">/*------------------------------------------------ Gray -&gt; XYZ */</span>
01582                 {
01583                         theXlutSize = (1 &lt;&lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> ) * (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01584                         theXlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theXlutSize + <span class="keyword">sizeof</span> (UINT16), &amp;aOSerr);
01585                         err = aOSerr;
01586                         <span class="keywordflow">if</span> (err)
01587                                 <span class="keywordflow">goto</span> CleanupAndExit;
01588                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theXlut);
01589                         wordPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theXlut);
01590                         *(wordPtr    )  = 0x0000;
01591                         *(wordPtr + 1)  = 0x0000;
01592                         *(wordPtr + 2)  = 0x0000;
01593                         *(wordPtr + 3)  = 0x0f6d5 / 2;
01594                         *(wordPtr + 4)  = 0x0ffff / 2;
01595                         *(wordPtr + 5)  = 0x0d3c2 / 2;
01596                         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theXlut);
01597                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 16;
01598                 }
01599         }
01600 
01601         <span class="comment">/* </span>
01602 <span class="comment">                                                                                                        E l u t</span>
01603 <span class="comment">           */</span>
01604         theElutSize = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>) * <span class="keyword">sizeof</span> (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01605         theElut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theElutSize * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> + sizeof (UINT16), &amp;aOSerr);
01606         err = aOSerr;
01607         <span class="keywordflow">if</span> (err)
01608                 <span class="keywordflow">goto</span> CleanupAndExit;
01609         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theElut);
01610                 
01611         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01612         {
01613                 <span class="comment">/* -----------------------------------------------------------------------------</span>
01614 <span class="comment">                        if PCS -&gt; create Elut</span>
01615 <span class="comment">                   -----------------------------------------------------------------------------*/</span>
01616                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> )                                        <span class="comment">/* this is NOT the first Elut */</span>
01617                 {
01618                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut), theElutSize / <span class="keyword">sizeof</span>(UINT16), theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>, 0);
01619                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = theElutSize / <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01620                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01621                 }
01622         <span class="keywordflow">else</span>                                                                                                            <span class="comment">/* this is the first Elut*/</span>
01623         {
01624                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )       <span class="comment">/* UWE 9.2.96 */</span>
01625                 {
01626                     <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut), theElutSize / <span class="keyword">sizeof</span>(UINT16), theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, 0);
01627                     theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01628                 }
01629                 <span class="keywordflow">else</span>
01630                         {
01631                                 <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a7">CreateLinearElut</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut), theElutSize / <span class="keyword">sizeof</span>(UINT16), theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, 0);
01632                                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
01633                         }
01634                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = theElutSize / <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01635                 }
01636         }
01637         <span class="keywordflow">else</span>
01638         {
01639                 <span class="comment">/* -----------------------------------------------------------------------------</span>
01640 <span class="comment">                        ... else get Elut from TRC tag</span>
01641 <span class="comment">                   -----------------------------------------------------------------------------*/</span>
01642                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a>  )                                       <span class="comment">/* this is NOT the first Elut */</span>
01643                 {
01644                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag</a>(pCurveTag, (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut), adr_breite_elut, VAL_USED_BITS, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>);
01645                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
01646                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01647                 }
01648                 <span class="keywordflow">else</span>                                                                                                            <span class="comment">/* this is the first Elut */</span>
01649                 {
01650                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )               <span class="comment">/* UWE 9.2.96 */</span>
01651                 {
01652                     err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag</a>(pCurveTag, (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut), adr_breite_elut, VAL_USED_BITS, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>);
01653                     theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01654                         }
01655                 <span class="keywordflow">else</span>
01656                 {
01657                     err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag</a>(pCurveTag, (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut), adr_breite_elut, bit_breite_elut, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>);
01658                     theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
01659                         }
01660             theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
01661                 }
01662 
01663         }
01664         <span class="keywordflow">for</span> (loop = 1; loop &lt; (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>); loop++)
01665                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theElut) + loop * theElutSize, theElutSize);
01666         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theElut);
01667 
01668         <span class="comment">/* </span>
01669 <span class="comment">                                                                                                        A l u t</span>
01670 <span class="comment">           */</span>
01671         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> ) <span class="comment">/* UWE 9.2.96*/</span>
01672                 theSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01673         <span class="keywordflow">else</span>
01674                 theSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>);
01675         
01676         theAlutSize = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a22">adr_breite_alut</a>);
01677         theAlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> * theAlutSize * theSize + theSize, &amp;aOSerr);
01678         err = aOSerr;
01679         <span class="keywordflow">if</span> (err)
01680                 <span class="keywordflow">goto</span> CleanupAndExit;
01681 
01682         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theAlut);
01683         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01684         {
01685                 <span class="comment">/* -----------------------------------------------------------------------------</span>
01686 <span class="comment">                        if PCS -&gt; get Alut from TRC tag</span>
01687 <span class="comment">                   -----------------------------------------------------------------------------*/</span>
01688                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )  <span class="comment">/*  UWE 9.2.96                  this is NOT the last Alut*/</span>
01689                 {
01690                         err = <a class="code" href="../../d5/d7/w98_2lh__core_2frgmnt16_8c.html#a2">Fill_inverse_ushort_ALUT_from_CurveTag</a>( pCurveTag, (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut), adr_breite_alut);
01691                         <span class="keywordflow">if</span> (err)
01692                                 <span class="keywordflow">goto</span> CleanupAndExit;
01693                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
01694                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01695                 }
01696                 <span class="keywordflow">else</span>                                                                                                                    <span class="comment">/* this is the last Alut */</span>
01697                 {
01698                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a5">Fill_inverse_byte_ALUT_from_CurveTag</a>( pCurveTag, (UINT8*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut), adr_breite_alut);
01699                         <span class="keywordflow">if</span> (err)
01700                                 <span class="keywordflow">goto</span> CleanupAndExit;
01701                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
01702                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a23">bit_breite_alut</a>;
01703                 }
01704         } <span class="keywordflow">else</span>
01705         {
01706                 <span class="comment">/* -----------------------------------------------------------------------------</span>
01707 <span class="comment">                        ... else create linear Alut</span>
01708 <span class="comment">                   -----------------------------------------------------------------------------*/</span>
01709                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )  <span class="comment">/* UWE 9.2.96                   this is NOT the last Alut */</span>
01710                 {
01711                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a9">CreateLinearAlut16</a> ( (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut), theAlutSize);
01712                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
01713                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01714                         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a> )
01715                                 <a class="code" href="../../d1/d1/w98_2lh__core_2genluts_8c.html#a11">SetMem16</a>((Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut) + theAlutSize * theSize, (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> -1 ) * theAlutSize, 0x08000);
01716                         <span class="keywordflow">else</span>
01717                         {
01718                                 <span class="keywordflow">for</span> (loop = 1; loop &lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; loop++)
01719                                         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut) + loop * theAlutSize * <span class="keyword">sizeof</span>(UINT16), theAlutSize * <span class="keyword">sizeof</span>(UINT16));
01720                         }
01721                 }
01722                 <span class="keywordflow">else</span>                                                                                                            <span class="comment">/* this is the last Alut */</span>
01723                 {
01724                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a8">CreateLinearAlut</a> ( (UINT8 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut), theAlutSize);
01725                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = theAlutSize;
01726                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01727                         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a110">icSigLabData</a> )
01728                                 <a class="code" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem</a>((Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut) + theAlutSize * theSize, (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> -1 ) * theAlutSize * theSize, 0x080);
01729                         <span class="keywordflow">else</span>
01730                         {
01731                                 <span class="keywordflow">for</span> (loop = 1; loop &lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; loop++)
01732                                         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theAlut) + loop * theAlutSize, theAlutSize);
01733                         }
01734                 }
01735         }
01736         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theAlut);
01737 
01738         <span class="comment">/* --------------------------------------------------------------------------------- */</span>
01739         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> = theElut; theElut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01740         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = theAlut; theAlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01741         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = theXlut; theXlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01742 
01743         <span class="comment">/* ---------------------------------------------------------------------------------</span>
01744 <span class="comment">            clean up</span>
01745 <span class="comment">           --------------------------------------------------------------------------------- */</span>
01746 CleanupAndExit:
01747         pCurveTag       = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)pCurveTag);
01748         theElut         =  <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theElut);
01749         theAlut         =  <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theAlut);
01750         theXlut         =  <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theXlut);
01751 
01752         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Extract_Gray_Luts"</span>)
01753         return err;
01754 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a13" doxytag="w98/lh_core/genluts.h::Extract_MFT_Alut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Extract_MFT_Alut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>profileLutPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theTag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00830">830</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00066">adr_bereich_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00067">adr_breite_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00068">bit_breite_alut</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00050">Boolean</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00085">CMGetPartialProfileElement()</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00106">LHCombiData::doCreate_16bit_ALut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00108">LHCombiData::doCreate_16bit_Combi</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/lh__core_2fragment_8c-source.html#l01237">Fill_byte_ALUTs_from_lut16Tag()</a>, <a class="el" href="../../d0/d6/lh__core_2fragment_8c-source.html#l01028">Fill_byte_ALUTs_from_lut8Tag()</a>, <a class="el" href="../../d6/d6/w98_2lh__core_2frgmnt16_8c-source.html#l00414">Fill_ushort_ALUTs_from_lut16Tag()</a>, <a class="el" href="../../d6/d6/w98_2lh__core_2frgmnt16_8c-source.html#l00316">Fill_ushort_ALUTs_from_lut8Tag()</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00221">icSigLut8Type</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00036">CMLutParam::outputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00037">CMLutParam::outputLutWordSize</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00039">SINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00973">ExtractAll_MFT_Luts()</a>, and <a class="el" href="../../d7/d5/lh__open_2pi__cmm_8c-source.html#l00342">MakeSessionFromLink()</a>.
<p>
<pre class="fragment"><div>00834 {
00835         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>         err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00836         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>           aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00837         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>          byteCount;
00838         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          offset;
00839         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          clutSize;
00840         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          i;
00841         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          inputTableEntries;
00842         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          outputTableEntries;
00843         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                     theOutputLuts   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;  <span class="comment">/* 12/1/95;*/</span>
00844         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>         readLutFromFile = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00845         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*         shortPtr;
00846         
00847         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Extract_MFT_Alut"</span>)
00848         
00849         clutSize = theLutData-&gt;colorLutOutDim;
00850         for(i=0; i&lt;theLutData-&gt;colorLutInDim; i++)
00851                 clutSize *= theLutData-&gt;colorLutGridPoints;
00852         <span class="comment">/* ============================================================================================================================</span>
00853 <span class="comment">                                                                                                                                 mft1</span>
00854 <span class="comment">           ============================================================================================================================ */</span>
00855         if ( *((OSType*)profileLutPtr) == icSigLut8Type )
00856         {
00857                 <span class="comment">/* --------------------------------------------------------------------------------- get outputLuts out of the profile */</span>
00858                 inputTableEntries  = 256;
00859                 outputTableEntries = 256;
00860                 offset                     = 48 + (inputTableEntries * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>) + clutSize;
00861                 byteCount = theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> * outputTableEntries;
00862         theOutputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(byteCount, &amp;aOSerr);
00863                 err = aOSerr;
00864                 <span class="keywordflow">if</span> (err)
00865                         <span class="keywordflow">goto</span> CleanupAndExit;
00866                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a2">CMGetPartialProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, theTag, offset, &amp;byteCount, theOutputLuts);
00867                 <span class="keywordflow">if</span> (err)
00868                         <span class="keywordflow">goto</span> CleanupAndExit;
00869                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )  <span class="comment">/* this is NOT the last Alut*/</span>
00870                 {
00871                         err = <a class="code" href="../../d5/d7/w98_2lh__core_2frgmnt16_8c.html#a3">Fill_ushort_ALUTs_from_lut8Tag</a>( theLutData, theOutputLuts, adr_breite_alut);
00872                         <span class="keywordflow">if</span> (err)
00873                                 <span class="keywordflow">goto</span> CleanupAndExit;
00874                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a21">adr_bereich_alut</a>;
00875                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00876                 }
00877                 <span class="keywordflow">else</span>                                                                                                                                                    <span class="comment">/* this is the last Alut */</span>
00878                 {
00879                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a8">Fill_byte_ALUTs_from_lut8Tag</a>( theLutData, theOutputLuts, adr_breite_alut);
00880                         <span class="keywordflow">if</span> (err)
00881                                 <span class="keywordflow">goto</span> CleanupAndExit;
00882                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a21">adr_bereich_alut</a>;
00883                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a23">bit_breite_alut</a>;
00884                 }
00885         }
00886         <span class="comment">/* ============================================================================================================================</span>
00887 <span class="comment">                                                                                                                                 mft2</span>
00888 <span class="comment">           ============================================================================================================================ */</span>
00889         <span class="keywordflow">else</span>
00890         {
00891                 <span class="comment">/* --------------------------------------------------------------------------------- get outputLuts out of the profile */</span>
00892                 inputTableEntries       = ((<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a> *)profileLutPtr)-&gt;lut.inputEnt;
00893                 <span class="keywordflow">if</span> (inputTableEntries &lt;2)
00894                 {
00895 <span class="preprocessor">#if realThing</span>
00896 <span class="preprocessor"></span>                        err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
00897                         <span class="keywordflow">goto</span> CleanupAndExit;
00898 <span class="preprocessor">#endif</span>
00899 <span class="preprocessor"></span>                }
00900                 outputTableEntries      = ((<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a> *)profileLutPtr)-&gt;lut.outputEnt;
00901                 <span class="keywordflow">if</span> (outputTableEntries &lt;2)
00902                 {
00903 <span class="preprocessor">#if ! realThing</span>
00904 <span class="preprocessor"></span>                        readLutFromFile = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00905                         outputTableEntries = 2;
00906 <span class="preprocessor">#else</span>
00907 <span class="preprocessor"></span>                        err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
00908                         <span class="keywordflow">goto</span> CleanupAndExit;
00909 <span class="preprocessor">#endif</span>
00910 <span class="preprocessor"></span>                }
00911                 <span class="keywordflow">if</span> (readLutFromFile)
00912                 {
00913                         offset          = 52 + (( inputTableEntries * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>) + clutSize) * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
00914                         byteCount       = theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> * outputTableEntries * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
00915                 theOutputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(byteCount, &amp;aOSerr);
00916                         err = aOSerr;
00917                         <span class="keywordflow">if</span> (err)
00918                                 <span class="keywordflow">goto</span> CleanupAndExit;
00919                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a2">CMGetPartialProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, theTag, offset, &amp;byteCount, theOutputLuts);
00920                         <span class="keywordflow">if</span> (err)
00921                                 <span class="keywordflow">goto</span> CleanupAndExit;
00922 <span class="preprocessor">#ifdef IntelMode</span>
00923 <span class="preprocessor"></span>           SwapShortOffset( theOutputLuts, 0, byteCount );
00924 <span class="preprocessor">#endif</span>
00925 <span class="preprocessor"></span>                } <span class="keywordflow">else</span>
00926                 {
00927                         theOutputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(2 * <span class="keyword">sizeof</span>(SINT16) * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>, &amp;aOSerr);
00928                         err = aOSerr;
00929                         <span class="keywordflow">if</span> (err)
00930                                 <span class="keywordflow">goto</span> CleanupAndExit;
00931                         shortPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)theOutputLuts;
00932                         <span class="keywordflow">for</span> (i = 0; i&lt; ( theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> * outputTableEntries ); i+=outputTableEntries)
00933                         {
00934                                 shortPtr[i]     = 0;
00935                                 shortPtr[i+1]   = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>)0xFFFF;
00936                         }
00937                 }
00938                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )<span class="comment">/*  UWE 9.2.96    this is NOT the last Alut */</span>
00939                 {
00940                         err = <a class="code" href="../../d5/d7/w98_2lh__core_2frgmnt16_8c.html#a4">Fill_ushort_ALUTs_from_lut16Tag</a>( theLutData, theOutputLuts, adr_breite_alut, outputTableEntries);
00941                         <span class="keywordflow">if</span> (err)
00942                                 <span class="keywordflow">goto</span> CleanupAndExit;
00943                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a21">adr_bereich_alut</a>;
00944                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00945                 }
00946                 <span class="keywordflow">else</span>                                                                                                            <span class="comment">/*  this is the last Alut */</span>
00947                 {
00948                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a11">Fill_byte_ALUTs_from_lut16Tag</a>( theLutData, theOutputLuts, adr_breite_alut, outputTableEntries);
00949                         <span class="keywordflow">if</span> (err)
00950                                 <span class="keywordflow">goto</span> CleanupAndExit;
00951                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a21">adr_bereich_alut</a>;
00952                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a23">bit_breite_alut</a>;
00953                 }
00954         }
00955         
00956         <span class="comment">/*---------------------------------------------------------------------------------</span>
00957 <span class="comment">           clean up &amp; exit</span>
00958 <span class="comment">          ---------------------------------------------------------------------------------*/</span>
00959 CleanupAndExit:
00960         theOutputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(theOutputLuts);
00961 
00962         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Extract_MFT_Alut"</span>)
00963         return err;
00964 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a12" doxytag="w98/lh_core/genluts.h::Extract_MFT_Elut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Extract_MFT_Elut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>profileLutPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theTag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00512">512</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00062">adr_breite_elut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00063">bit_breite_elut</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00050">Boolean</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00085">CMGetPartialProfileElement()</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00108">LHCombiData::doCreate_16bit_Combi</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00104">LHCombiData::doCreate_16bit_ELut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00107">LHCombiData::doCreateLinkProfile</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d0/d6/lh__core_2fragment_8c-source.html#l01121">Fill_ushort_ELUTs_from_lut16Tag()</a>, <a class="el" href="../../d0/d6/lh__core_2fragment_8c-source.html#l00941">Fill_ushort_ELUTs_from_lut8Tag()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00099">LHCombiData::gridPointsCube</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00221">icSigLut8Type</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00033">CMLutParam::inputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00034">CMLutParam::inputLutWordSize</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00102">LHCombiData::maxProfileCount</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00103">LHCombiData::profLoop</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00039">SINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00973">ExtractAll_MFT_Luts()</a>, and <a class="el" href="../../d7/d5/lh__open_2pi__cmm_8c-source.html#l00342">MakeSessionFromLink()</a>.
<p>
<pre class="fragment"><div>00516 {
00517         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>         err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00518         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>           aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00519         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>          byteCount;
00520         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          offset;
00521         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          i;
00522         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          inputTableEntries;
00523         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                     theInputLuts    = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;          <span class="comment">/*12/1/95*/</span>
00524         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>         readLutFromFile = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
00525         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*         shortPtr;
00526         
00527         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Extract_MFT_Elut"</span>)
00528         
00529         <span class="comment">/* ============================================================================================================================</span>
00530 <span class="comment">                                                                                                                                 mft1</span>
00531 <span class="comment">           ============================================================================================================================ */</span>
00532         if ( *((OSType*)profileLutPtr) == icSigLut8Type )
00533         {
00534                 <span class="comment">/* --------------------------------------------------------------------------------- get inputLuts out of the profile */</span>
00535                 inputTableEntries       = 256;
00536                 offset                          = 48;   <span class="comment">/* input luts for mft1 start at byte 48 */</span>
00537                 byteCount                       = theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> * inputTableEntries;
00538                 theInputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(byteCount, &amp;aOSerr);
00539                 err = aOSerr;
00540                 <span class="keywordflow">if</span> (err)
00541                         <span class="keywordflow">goto</span> CleanupAndExit;
00542                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a2">CMGetPartialProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, theTag, offset, &amp;byteCount, theInputLuts);
00543                 <span class="keywordflow">if</span> (err)
00544                         <span class="keywordflow">goto</span> CleanupAndExit;
00545                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> )        <span class="comment">/* this is NOT the first Elut -or- doCreateLinkProfile */</span>
00546                 {
00547                                                                                                                                                 <span class="comment">/* if we create a LinkProfile the Elut should not be scaled... */</span>
00548                         <span class="keywordflow">if</span> ((theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a>) &amp;&amp; (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o8">profLoop</a> == 0))
00549                                 err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a7">Fill_ushort_ELUTs_from_lut8Tag</a>( theLutData, theInputLuts, adr_breite_elut, bit_breite_elut, 0 );
00550                         <span class="keywordflow">else</span>                                                                                                            <span class="comment">/* else scale Elut to gridpoints in profile... */</span>
00551                                 err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a7">Fill_ushort_ELUTs_from_lut8Tag</a>( theLutData, theInputLuts, adr_breite_elut, VAL_USED_BITS, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a> );
00552                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
00553                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00554                 }
00555                 <span class="keywordflow">else</span>                                                                                                                    <span class="comment">/* this is the first Elut */</span>
00556                 {
00557             <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )   <span class="comment">/* UWE 9.2.96 */</span>
00558                 {
00559                     <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> == 0)                                     <span class="comment">/* if we have only one profile, the scale Elut to gridpoints in profile...*/</span>
00560                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a7">Fill_ushort_ELUTs_from_lut8Tag</a>( theLutData, theInputLuts, adr_breite_elut, VAL_USED_BITS, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a> );
00561                     <span class="keywordflow">else</span>                                                                                                        <span class="comment">/* else scale Elut to the gridpoints in the cube...*/</span>
00562                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a7">Fill_ushort_ELUTs_from_lut8Tag</a>( theLutData, theInputLuts, adr_breite_elut, VAL_USED_BITS, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a> );
00563                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00564             }
00565             <span class="keywordflow">else</span>
00566             {
00567                     <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> == 0)                                     <span class="comment">/* if we have only one profile, the scale Elut to gridpoints in profile...*/</span>
00568                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a7">Fill_ushort_ELUTs_from_lut8Tag</a>( theLutData, theInputLuts, adr_breite_elut, bit_breite_elut, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a> );
00569                     <span class="keywordflow">else</span>                                                                                                        <span class="comment">/* else scale Elut to the gridpoints in the cube...*/</span>
00570                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a7">Fill_ushort_ELUTs_from_lut8Tag</a>( theLutData, theInputLuts, adr_breite_elut, bit_breite_elut, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a> );
00571                     theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
00572 
00573             }
00574             theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
00575                 }
00576         }
00577         <span class="keywordflow">else</span>
00578         <span class="comment">/* ============================================================================================================================</span>
00579 <span class="comment">                                                                                                                                 mft2</span>
00580 <span class="comment">           ============================================================================================================================ */</span>
00581         {
00582                 <span class="comment">/* --------------------------------------------------------------------------------- get inputLuts out of the profile */</span>
00583                 inputTableEntries       = ((<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a> *)profileLutPtr)-&gt;lut.inputEnt;
00584                 <span class="keywordflow">if</span> (inputTableEntries &lt;2)
00585                 {
00586 <span class="preprocessor">#if ! realThing</span>
00587 <span class="preprocessor"></span>                        readLutFromFile = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
00588                         inputTableEntries = 2;
00589 <span class="preprocessor">#else</span>
00590 <span class="preprocessor"></span>                        err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
00591                         <span class="keywordflow">goto</span> CleanupAndExit;
00592 <span class="preprocessor">#endif</span>
00593 <span class="preprocessor"></span>                }
00594                 <span class="keywordflow">if</span> (readLutFromFile)
00595                 {
00596                         offset                          = 52;   <span class="comment">/* input luts for mft2 start at byte 52 */</span>
00597                         byteCount                       = theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> * inputTableEntries * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
00598                         theInputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(byteCount, &amp;aOSerr);
00599                         err = aOSerr;
00600                         <span class="keywordflow">if</span> (err)
00601                                 <span class="keywordflow">goto</span> CleanupAndExit;
00602                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a2">CMGetPartialProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, theTag, offset, &amp;byteCount, theInputLuts);
00603 <span class="preprocessor">#ifdef IntelMode</span>
00604 <span class="preprocessor"></span>            SwapShortOffset( theInputLuts, 0, byteCount );
00605 <span class="preprocessor">#endif</span>
00606 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (err)
00607                                 <span class="keywordflow">goto</span> CleanupAndExit;
00608                 } <span class="keywordflow">else</span>
00609                 {
00610                         theInputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(inputTableEntries * <span class="keyword">sizeof</span>(SINT16) * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>, &amp;aOSerr);
00611                         err = aOSerr;
00612                         <span class="keywordflow">if</span> (err)
00613                                 <span class="keywordflow">goto</span> CleanupAndExit;    <span class="comment">/* 12/1/95 */</span>
00614                         shortPtr = (<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>*)theInputLuts;
00615                         <span class="keywordflow">for</span> (i = 0; i&lt; (theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a> * inputTableEntries); i+=inputTableEntries)
00616                         {
00617                                 shortPtr[i]     = 0;
00618                                 shortPtr[i+1]   = 0xFFFF;
00619                         }
00620                 }
00621                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> )                                                <span class="comment">/* this is NOT the first Elut -or- doCreateLinkProfile */</span>
00622                 {
00623                                                                                                                                                 <span class="comment">/* if we create a LinkProfile the Elut should not be scaled... */</span>
00624                         <span class="keywordflow">if</span> ((theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a>) &amp;&amp; (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o8">profLoop</a> == 0))
00625                                 err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a10">Fill_ushort_ELUTs_from_lut16Tag</a>( theLutData, theInputLuts, adr_breite_elut, VAL_USED_BITS, 0, inputTableEntries );
00626                         <span class="keywordflow">else</span>                                                                                                            <span class="comment">/* else scale Elut to gridpoints in profile... */</span>
00627                                 err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a10">Fill_ushort_ELUTs_from_lut16Tag</a>( theLutData, theInputLuts, adr_breite_elut, VAL_USED_BITS, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>, inputTableEntries );
00628                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
00629                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00630                 }
00631                 <span class="keywordflow">else</span>                                                                                                                    <span class="comment">/* this is the first Elut */</span>
00632                 {
00633                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )       <span class="comment">/* UWE 9.2.96 */</span>
00634                 {
00635                     <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> == 0)                                     <span class="comment">/* if we have only one profile, the scale Elut to gridpoints in profile...*/</span>
00636                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a10">Fill_ushort_ELUTs_from_lut16Tag</a>( theLutData, theInputLuts, adr_breite_elut, VAL_USED_BITS, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>, inputTableEntries );
00637                     <span class="keywordflow">else</span>                                                                                                        <span class="comment">/* else scale Elut to the gridpoints in the cube...*/</span>
00638                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a10">Fill_ushort_ELUTs_from_lut16Tag</a>( theLutData, theInputLuts, adr_breite_elut, VAL_USED_BITS, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, inputTableEntries );
00639                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00640             }
00641             <span class="keywordflow">else</span>
00642             {
00643                     <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> == 0)                                     <span class="comment">/* if we have only one profile, the scale Elut to gridpoints in profile...*/</span>
00644                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a10">Fill_ushort_ELUTs_from_lut16Tag</a>( theLutData, theInputLuts, adr_breite_elut, bit_breite_elut, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>, inputTableEntries );
00645                     <span class="keywordflow">else</span>                                                                                                        <span class="comment">/* else scale Elut to the gridpoints in the cube...*/</span>
00646                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a10">Fill_ushort_ELUTs_from_lut16Tag</a>( theLutData, theInputLuts, adr_breite_elut, bit_breite_elut, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, inputTableEntries );
00647                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
00648            }
00649             theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
00650                 }
00651         }
00652         <span class="keywordflow">if</span> (err)
00653                 <span class="keywordflow">goto</span> CleanupAndExit;
00654 
00655         <span class="comment">/* ---------------------------------------------------------------------------------</span>
00656 <span class="comment">            clean up &amp; exit</span>
00657 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
00658 CleanupAndExit:
00659         theInputLuts = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(theInputLuts);
00660 
00661         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Extract_MFT_Elut"</span>)
00662         return err;
00663 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a11" doxytag="w98/lh_core/genluts.h::Extract_MFT_Xlut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Extract_MFT_Xlut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a28">Ptr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>profileLutPtr</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theTag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00673">673</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00043">ALLOC_DATA</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00085">CMGetPartialProfileElement()</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00043">CMLutParam::colorLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00042">CMLutParam::colorLutWordSize</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00038">DATA_2_PTR</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00045">DISPOSE_IF_DATA</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00105">LHCombiData::doCreate_16bit_XLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00107">LHCombiData::doCreateLinkProfile</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00221">icSigLut8Type</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00041">LOCK_DATA</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00036">LUT_DATA_TYPE</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00102">LHCombiData::maxProfileCount</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00042">UNLOCK_DATA</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00973">ExtractAll_MFT_Luts()</a>, and <a class="el" href="../../d7/d5/lh__open_2pi__cmm_8c-source.html#l00342">MakeSessionFromLink()</a>.
<p>
<pre class="fragment"><div>00677 {
00678         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00679         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00680         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  i;
00681         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  clutSize;
00682         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   localXlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00683         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                             tempXlut   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00684         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                             bytePtr   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00685         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                             xlutPtr   = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00686         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  offset;
00687         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  inputTableEntries;
00688         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  byteCount;
00689         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  theSize;
00690         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  aExtraSize;
00691         
00692         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Extract_MFT_Xlut"</span>)
00693         
00694         clutSize = theLutData-&gt;colorLutOutDim;
00695         for(i=0; i&lt;theLutData-&gt;colorLutInDim; i++)
00696                 clutSize *= theLutData-&gt;colorLutGridPoints;
00697 
00698         <span class="comment">/* ============================================================================================================================</span>
00699 <span class="comment">                                                                                                                                 mft1</span>
00700 <span class="comment">           ============================================================================================================================ */</span>
00701         if ( *((OSType*)profileLutPtr) == icSigLut8Type )
00702         {
00703                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> == 0 ){                      <span class="comment">/* Link Profile UK13.8.96*/</span>
00704                         theSize = 1;
00705                         aExtraSize = 1;
00706                         <span class="keywordflow">for</span>( i=0; i&lt;(theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>-1); ++i){        <span class="comment">/* Extra Size for Interpolation */</span>
00707                                 theSize *= theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>;
00708                                 aExtraSize += theSize;
00709                         }
00710 <span class="preprocessor">#ifdef ALLOW_MMX</span>
00711 <span class="preprocessor"></span>                        aExtraSize++;   <span class="comment">/* +1 for MMX 4 Byte access */</span>
00712 <span class="preprocessor">#endif</span>
00713 <span class="preprocessor"></span>                }       
00714                 <span class="keywordflow">else</span>{
00715                         aExtraSize = 0;
00716                 }
00717                 aExtraSize *= theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
00718                 localXlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(clutSize+aExtraSize, &amp;aOSerr);   
00719         err = aOSerr;   
00720                 <span class="keywordflow">if</span> (err)
00721                         <span class="keywordflow">goto</span> CleanupAndExit;
00722                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(localXlut);
00723                 inputTableEntries       = 256;
00724                 offset                          = 48 + (inputTableEntries * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>);
00725                 byteCount                       = clutSize;
00726                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a2">CMGetPartialProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, theTag, offset, &amp;byteCount, <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localXlut));
00727                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 8;
00728                 <span class="keywordflow">if</span> (err)
00729                         <span class="keywordflow">goto</span> CleanupAndExit;
00730         } <span class="keywordflow">else</span>
00731         <span class="comment">/* ============================================================================================================================</span>
00732 <span class="comment">                                                                                                                                 mft2</span>
00733 <span class="comment">           ============================================================================================================================ */</span>
00734         {
00735                 <span class="keywordflow">if</span> (( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> &gt; 0 ) || (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a>) || (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a>))<span class="comment">/* UWE 9.2.96*/</span>
00736                         clutSize *= 2;
00737                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> == 0 ){                      <span class="comment">/* Link Profile  UK13.8.96*/</span>
00738                         theSize = 1;
00739                         aExtraSize = 1;
00740                         <span class="keywordflow">for</span>( i=0; i&lt;(theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>-1); ++i){        <span class="comment">/* Extra Size for Interpolation */</span>
00741                                 theSize *= theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>;
00742                                 aExtraSize += theSize;
00743                         }
00744                         <span class="keywordflow">if</span> (( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a>) || (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a>)){
00745                                 aExtraSize *= 2;
00746                         }
00747 <span class="preprocessor">#ifdef ALLOW_MMX</span>
00748 <span class="preprocessor"></span>                        aExtraSize++;   <span class="comment">/* +1 for MMX 4 Byte access */</span>
00749 <span class="preprocessor">#endif</span>
00750 <span class="preprocessor"></span>                }       
00751                 <span class="keywordflow">else</span>{
00752                         aExtraSize = 0;
00753                 }
00754                 aExtraSize *= theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
00755                 localXlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a8">ALLOC_DATA</a>(clutSize+aExtraSize, &amp;aOSerr);   
00756         err = aOSerr;
00757                 <span class="keywordflow">if</span> (err)
00758                         <span class="keywordflow">goto</span> CleanupAndExit;
00759                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(localXlut);
00760                 inputTableEntries       = ((<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a> *)profileLutPtr)-&gt;lut.inputEnt;
00761                 <span class="keywordflow">if</span> (inputTableEntries &lt;2)
00762                 {
00763                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
00764                         <span class="keywordflow">goto</span> CleanupAndExit;
00765                 }
00766                 offset = 52 + ( inputTableEntries * theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>) * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
00767                 
00768                 <span class="keywordflow">if</span> (( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o7">maxProfileCount</a> &gt; 0 ) || (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a>) || (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o10">doCreate_16bit_XLut</a>))<span class="comment">/* UWE 9.2.96 */</span>
00769                 {
00770                         byteCount = clutSize;
00771                         tempXlut  = 0;
00772                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a2">CMGetPartialProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, theTag, offset, &amp;byteCount, <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localXlut));
00773 <span class="preprocessor">#ifdef IntelMode</span>
00774 <span class="preprocessor"></span>           SwapShortOffset( localXlut, 0, byteCount );
00775 <span class="preprocessor">#endif</span>
00776 <span class="preprocessor"></span>                        theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
00777                         <span class="keywordflow">if</span> (err)
00778                                 <span class="keywordflow">goto</span> CleanupAndExit;
00779                 }
00780                 <span class="keywordflow">else</span>
00781                 {                                                                       <span class="comment">/* should only happen with 1 Link profile */</span>
00782 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
00783 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
00784                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" Extract_MFT_Xlut: 1 Link profile mode\n"</span>,err);
00785 <span class="preprocessor">#endif</span>
00786 <span class="preprocessor"></span>                        byteCount = clutSize * <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
00787                         tempXlut  = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(byteCount, &amp;aOSerr);
00788                 err = aOSerr;
00789                         <span class="keywordflow">if</span> (err)
00790                                 <span class="keywordflow">goto</span> CleanupAndExit;
00791                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a2">CMGetPartialProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, theTag, offset, &amp;byteCount, tempXlut);
00792 <span class="preprocessor">#ifdef IntelMode</span>
00793 <span class="preprocessor"></span><span class="comment">/*           SwapShortOffset( tempXlut, 0, byteCount ); !! do not swap, take first byte */</span>
00794 <span class="preprocessor">#endif</span>
00795 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (err)
00796                                 <span class="keywordflow">goto</span> CleanupAndExit;
00797                         bytePtr = tempXlut;
00798                         xlutPtr = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localXlut);
00799                         <span class="keywordflow">for</span> (i = 0; i &lt; clutSize; i++)
00800                         {
00801                                 *xlutPtr = *bytePtr;
00802                                 bytePtr+=2;
00803                                 xlutPtr++;
00804                         }
00805                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a> = 8;
00806                 }
00807         }
00808         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(localXlut);
00809         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = localXlut;
00810         localXlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00811         
00812         <span class="comment">/* ---------------------------------------------------------------------------------</span>
00813 <span class="comment">            clean up &amp; exit</span>
00814 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
00815 CleanupAndExit:
00816         localXlut = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(localXlut);
00817         tempXlut  = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(tempXlut);
00818 
00819         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Extract_MFT_Xlut"</span>)
00820         return err;
00821 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a15" doxytag="w98/lh_core/genluts.h::Extract_TRC_Alut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Extract_TRC_Alut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01057">1057</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00067">adr_breite_alut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00043">ALLOC_DATA</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00110">LHCombiData::amIPCS</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00766">icCurveType::base</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00068">bit_breite_alut</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00056">BlockMoveData</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00059">CMGetProfileElement()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00546">icCurve::count</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a8">CreateLinearAlut()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a9">CreateLinearAlut16()</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00767">icCurveType::curve</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00547">icCurve::data</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00038">DATA_2_PTR</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00045">DISPOSE_IF_DATA</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00106">LHCombiData::doCreate_16bit_ALut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00108">LHCombiData::doCreate_16bit_Combi</a>, <a class="el" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a5">Fill_inverse_byte_ALUT_from_CurveTag()</a>, <a class="el" href="../../d6/d6/w98_2lh__core_2frgmnt16_8c-source.html#l00070">Fill_inverse_ushort_ALUT_from_CurveTag()</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00144">icSigBlueTRCTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00157">icSigGreenTRCTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00178">icSigRedTRCTag</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00056">kNumOfRGBchannels</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00041">LOCK_DATA</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00036">LUT_DATA_TYPE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00038">CMLutParam::outputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00036">CMLutParam::outputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00037">CMLutParam::outputLutWordSize</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00760">icTagBase::sig</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00039">SINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00038">SINT8</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00030">UINT8</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00042">UNLOCK_DATA</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01421">ExtractAll_TRC_Luts()</a>.
<p>
<pre class="fragment"><div>01059 {
01060         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  trcSig[<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a16">kNumOfRGBchannels</a>];
01061         <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>*    pCurveTag          = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01062         <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>*    invertCurveTag = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01063         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01064         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01065         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  elementSize;
01066         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  loop;
01067         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  theSize;
01068         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  theAlutSize;
01069         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a6">UINT8</a>                   addrBits;
01070         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   localAlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01071         
01072         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Extract_TRC_Alut"</span>)
01073         
01074         <span class="comment">/* ---------------------------------------------------- initialization */</span>
01075         addrBits = adr_breite_alut;
01076         if ( theCombiData-&gt;doCreate_16bit_ALut || theCombiData-&gt;doCreate_16bit_Combi )<span class="comment">/* UWE 9.2.96 */</span>
01077                 theSize = sizeof(UINT16);
01078         else
01079                 theSize = sizeof(UINT8);
01080         theAlutSize = (1&lt;&lt;addrBits);
01081         localAlut = ALLOC_DATA(theLutData-&gt;colorLutOutDim * theAlutSize * theSize + theSize, &amp;aOSerr);
01082         err = aOSerr;
01083         if (err)
01084         {
01085 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
01086 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ( err &amp;&amp; DebugCheck(kThisFile, kDebugErrorInfo) )
01087                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" Extract_TRC_Alut ALLOC_DATA(%d * %d) error\n"</span>,theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a> , theAlutSize);
01088 <span class="preprocessor">#endif</span>
01089 <span class="preprocessor"></span>                <span class="keywordflow">goto</span> CleanupAndExit;
01090         }
01091         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(localAlut);
01092         <span class="keywordflow">if</span> (!theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01093         {                       
01094                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01095 <span class="comment">                                if NOT PCS -&gt; create linear Alut ...</span>
01096 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01097                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )<span class="comment">/* UWE 9.2.96             this is NOT the last Alut */</span>
01098                 {
01099                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a9">CreateLinearAlut16</a> ( (UINT16 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut),theAlutSize);
01100                         <span class="keywordflow">for</span> (loop = 0; loop &lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; loop++)
01101                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut) + loop * theAlutSize * <span class="keyword">sizeof</span>(UINT16), theAlutSize * <span class="keyword">sizeof</span>(UINT16));
01102                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
01103                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01104                 }
01105                 <span class="keywordflow">else</span>                                                                                                    <span class="comment">/* this is NOT the last Alut */</span>
01106                 {
01107                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a8">CreateLinearAlut</a> ( (UINT8 *)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut),theAlutSize);
01108                         <span class="keywordflow">for</span> (loop = 0; loop &lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>; loop++)
01109                                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut) + loop * theAlutSize, theAlutSize);
01110                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
01111                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = 8;
01112                 }
01113         }
01114         <span class="keywordflow">else</span>
01115         {
01116                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01117 <span class="comment">                        ... else take TRCs for Aluts</span>
01118 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01119                 trcSig[0] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a56">icSigRedTRCTag</a>;
01120                 trcSig[1] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a35">icSigGreenTRCTag</a>;
01121                 trcSig[2] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a22">icSigBlueTRCTag</a>;
01122                                 
01123                 <span class="keywordflow">for</span> (loop = 0; loop &lt; <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a16">kNumOfRGBchannels</a>; loop++)
01124                 {
01125                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, trcSig[loop], &amp;elementSize, nil);
01126                         <span class="keywordflow">if</span> (err)
01127                                 <span class="keywordflow">goto</span> CleanupAndExit;
01128             pCurveTag = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(elementSize, &amp;aOSerr);
01129                         err = aOSerr;
01130                         <span class="keywordflow">if</span> (err)
01131                                 <span class="keywordflow">goto</span> CleanupAndExit;
01132 
01133                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, trcSig[loop], &amp;elementSize, pCurveTag);
01134                         <span class="keywordflow">if</span> (err){
01135                                 <span class="keywordflow">goto</span> CleanupAndExit;
01136                         }
01137 <span class="preprocessor">#ifdef IntelMode</span>
01138 <span class="preprocessor"></span>            SwapLongOffset( &amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o0">base</a>.<a class="code" href="../../d6/d4/structicTagBase.html#o0">sig</a>, 0, 4 );
01139             SwapLong( &amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o0">count</a> );
01140             SwapShortOffset( pCurveTag, (ULONG)((SINT8*)&amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o1">data</a>[0]-(SINT8*)pCurveTag), elementSize );
01141 <span class="preprocessor">#endif</span>
01142 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (pCurveTag)
01143                         {
01144                                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o11">doCreate_16bit_ALut</a> || theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )  <span class="comment">/* UWE 9.2.96            this is NOT the last Alut*/</span>
01145                                 {
01146                                         err = <a class="code" href="../../d5/d7/w98_2lh__core_2frgmnt16_8c.html#a2">Fill_inverse_ushort_ALUT_from_CurveTag</a>( pCurveTag, (UINT16*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut) + (theAlutSize * loop), addrBits);
01147                                         <span class="keywordflow">if</span> (err)
01148                                                 <span class="keywordflow">goto</span> CleanupAndExit;
01149                                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
01150                                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01151                                 }
01152                                 <span class="keywordflow">else</span>                                                                                            <span class="comment">/* this is the last Alut */</span>
01153                                 {
01154                                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a5">Fill_inverse_byte_ALUT_from_CurveTag</a>( pCurveTag, (UINT8*)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localAlut) + (theAlutSize * loop), addrBits);
01155                                         <span class="keywordflow">if</span> (err)
01156                                                 <span class="keywordflow">goto</span> CleanupAndExit;
01157                                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a> = (<a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a13">SINT16</a>)theAlutSize;
01158                                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a23">bit_breite_alut</a>;
01159                                 }
01160                                 pCurveTag = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)pCurveTag);
01161                         } <span class="keywordflow">else</span>
01162                         {
01163                                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a56">unimpErr</a>;
01164                                 <span class="keywordflow">goto</span> CleanupAndExit;
01165                         }
01166                 }
01167         }
01168         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(localAlut);
01169         <span class="comment">/* ----------------------------------------------- no error occured -&gt; save results */</span>
01170         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>   = localAlut;    
01171         localAlut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01172         <span class="comment">/* ---------------------------------------------------------------------------------</span>
01173 <span class="comment">            clean up &amp; exit</span>
01174 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
01175 CleanupAndExit:
01176         localAlut               = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(localAlut);
01177         pCurveTag               = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>*)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)pCurveTag);
01178 
01179         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Extract_TRC_Alut"</span>)
01180         return err;
01181 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a16" doxytag="w98/lh_core/genluts.h::Extract_TRC_Elut" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Extract_TRC_Elut           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01190">1190</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00062">adr_breite_elut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00043">ALLOC_DATA</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00110">LHCombiData::amIPCS</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00766">icCurveType::base</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00063">bit_breite_elut</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00056">BlockMoveData</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00059">CMGetProfileElement()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00546">icCurve::count</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a7">CreateLinearElut()</a>, <a class="el" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16()</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00767">icCurveType::curve</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00547">icCurve::data</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00038">DATA_2_PTR</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00045">DISPOSE_IF_DATA</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00108">LHCombiData::doCreate_16bit_Combi</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00104">LHCombiData::doCreate_16bit_ELut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00107">LHCombiData::doCreateLinkProfile</a>, <a class="el" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00099">LHCombiData::gridPointsCube</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00144">icSigBlueTRCTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00157">icSigGreenTRCTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00178">icSigRedTRCTag</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00035">CMLutParam::inputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00033">CMLutParam::inputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00034">CMLutParam::inputLutWordSize</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00056">kNumOfRGBchannels</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00041">LOCK_DATA</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00036">LUT_DATA_TYPE</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00103">LHCombiData::profLoop</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00760">icTagBase::sig</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00042">UNLOCK_DATA</a>, and <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00147">VAL_USED_BITS</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01421">ExtractAll_TRC_Luts()</a>.
<p>
<pre class="fragment"><div>01192 {
01193         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  trcSig[<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a16">kNumOfRGBchannels</a>];
01194         <a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a>*    pCurveTag = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01195         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  loop;
01196         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  theElutSize;
01197         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01198         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01199         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  elementSize;
01200         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a1">LUT_DATA_TYPE</a>   localElut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01201         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                             singleElut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01202 
01203         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Extract_TRC_Elut"</span>)
01204 
01205         theElutSize =  (1&lt;&lt;adr_breite_elut) * sizeof (UINT16);
01206         localElut = ALLOC_DATA(theLutData-&gt;colorLutInDim * theElutSize + sizeof (UINT16), &amp;aOSerr);
01207         err = aOSerr;
01208         if (err)
01209                 goto CleanupAndExit;
01210 
01211         <span class="comment">/* --------------------------------------------------------------------------------- set gridPoints */</span>
01212         theLutData-&gt;colorLutGridPoints = theCombiData-&gt;gridPointsCube;
01213         
01214         LOCK_DATA(localElut);
01215         if (theCombiData-&gt;amIPCS)
01216         {
01217                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01218 <span class="comment">                        if PCS -&gt; create linear Elut...</span>
01219 <span class="comment">                   --------------------------------------------------------------------------------- */</span>
01220                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a> )                                        <span class="comment">/* this is NOT the first Elut */</span>
01221                 {
01222                         <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localElut), theElutSize / <span class="keyword">sizeof</span>(UINT16), theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>, 0);
01223                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = theElutSize / <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01224                         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01225                 }
01226                 <span class="keywordflow">else</span>                                                                                                            <span class="comment">/* this is the first Elut */</span>
01227                 {
01228                 <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )                               <span class="comment">/* UWE 9.2.96 */</span>
01229                 {
01230                 <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a6">CreateLinearElut16</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localElut), theElutSize / <span class="keyword">sizeof</span>(UINT16), theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, 0);
01231                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01232             }
01233             <span class="keywordflow">else</span>
01234             {
01235                 <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a7">CreateLinearElut</a> ( (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localElut), theElutSize / <span class="keyword">sizeof</span>(UINT16), theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>, 0);
01236                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
01237             }
01238             theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = theElutSize / <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>);
01239                 }
01240                 <span class="keywordflow">for</span> (loop = 1; loop &lt; theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>; loop++)
01241                         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localElut), (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localElut) + loop * theElutSize, theElutSize);
01242         }
01243         <span class="keywordflow">else</span>
01244         {
01245                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01246 <span class="comment">                        ... else take TRCs for Eluts</span>
01247 <span class="comment">                   --------------------------------------------------------------------------------- */</span>
01248                 trcSig[0] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a56">icSigRedTRCTag</a>;
01249                 trcSig[1] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a35">icSigGreenTRCTag</a>;
01250                 trcSig[2] = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a22">icSigBlueTRCTag</a>;
01251                                                 
01252                 singleElut = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(theElutSize, &amp;aOSerr);
01253                 err = aOSerr;
01254                 <span class="keywordflow">if</span> (err)
01255                         <span class="keywordflow">goto</span> CleanupAndExit;
01256                 <span class="keywordflow">for</span> (loop = 0; loop &lt; <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a16">kNumOfRGBchannels</a>; loop++)
01257                 {
01258                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, trcSig[loop], &amp;elementSize, nil);
01259                         <span class="keywordflow">if</span> (err)
01260                                 <span class="keywordflow">goto</span> CleanupAndExit;
01261                         pCurveTag = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(elementSize, &amp;aOSerr);
01262                         err = aOSerr;
01263                         <span class="keywordflow">if</span> (err)
01264                                 <span class="keywordflow">goto</span> CleanupAndExit;
01265 
01266                         err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, trcSig[loop], &amp;elementSize, pCurveTag);
01267 <span class="preprocessor">#ifdef IntelMode</span>
01268 <span class="preprocessor"></span>            SwapLongOffset( &amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o0">base</a>.<a class="code" href="../../d6/d4/structicTagBase.html#o0">sig</a>, 0, 4 );
01269             SwapLong( &amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o0">count</a> );
01270             SwapShortOffset( pCurveTag, (ULONG)((<span class="keywordtype">char</span>*)&amp;pCurveTag-&gt;<a class="code" href="../../d5/d1/structicCurveType.html#o1">curve</a>.<a class="code" href="../../d4/d1/structicCurve.html#o1">data</a>[0]-(<span class="keywordtype">char</span>*)pCurveTag), elementSize );
01271 <span class="preprocessor">#endif</span>
01272 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (err)
01273                                 <span class="keywordflow">goto</span> CleanupAndExit;
01274                         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o9">doCreate_16bit_ELut</a>  )               <span class="comment">/* this is either NOT the first Elut -or- we have a NewLinkProfile call */</span>
01275                         {
01276                                 <span class="keywordflow">if</span> ((theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o12">doCreateLinkProfile</a>) &amp;&amp; (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o8">profLoop</a> == 0))
01277                                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag</a>(pCurveTag, (UINT16*)singleElut, adr_breite_elut, VAL_USED_BITS, 0);
01278                                 <span class="keywordflow">else</span>
01279                                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag</a>(pCurveTag, (UINT16*)singleElut, adr_breite_elut, VAL_USED_BITS, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>);
01280                                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
01281                                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01282                         }
01283                         <span class="keywordflow">else</span>                                                                                                            <span class="comment">/* this is the first Elut */</span>
01284                         {
01285                         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o13">doCreate_16bit_Combi</a> )       <span class="comment">/* UWE 9.2.96 */</span>
01286                         {
01287                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag</a>(pCurveTag, (UINT16*)singleElut, adr_breite_elut, VAL_USED_BITS, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>);
01288                     theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d0/d1/lh__core_2genluts_8c.html#a3">VAL_USED_BITS</a>;
01289                 }
01290                 <span class="keywordflow">else</span>
01291                 {
01292                         err = <a class="code" href="../../d2/d7/w98_2lh__core_2fragment_8h.html#a4">Fill_ushort_ELUT_from_CurveTag</a>(pCurveTag, (UINT16*)singleElut, adr_breite_elut, bit_breite_elut, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o4">gridPointsCube</a>);
01293                     theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a20">bit_breite_elut</a>;
01294                 }
01295                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a> = (1&lt;&lt;<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a19">adr_breite_elut</a>);
01296                         }
01297                         <span class="keywordflow">if</span> (err)
01298                                 <span class="keywordflow">goto</span> CleanupAndExit;
01299                         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(singleElut, (Ptr)<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(localElut) + loop * theElutSize, theElutSize);
01300                         pCurveTag  = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)pCurveTag);
01301                 }
01302         }
01303         <span class="comment">/* ----------------------------------------------- no error occured -&gt; save results */</span>
01304         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(localElut);
01305         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> = localElut;
01306         localElut = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
01307         <span class="comment">/* ---------------------------------------------------------------------------------</span>
01308 <span class="comment">                clean up &amp; exit</span>
01309 <span class="comment">           --------------------------------------------------------------------------------- */</span>
01310 CleanupAndExit:
01311         pCurveTag  = (<a class="code" href="../../d5/d1/structicCurveType.html">icCurveType</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)pCurveTag);
01312         localElut  = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(localElut);
01313         singleElut = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(singleElut);
01314 
01315         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Extract_TRC_Elut"</span>)
01316         return err;
01317 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a17" doxytag="w98/lh_core/genluts.h::Extract_TRC_Matrix" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> Extract_TRC_Matrix           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01324">1324</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00110">LHCombiData::amIPCS</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00886">icXYZType::base</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00056">BlockMoveData</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a38">cmElementTagNotFound</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00059">CMGetProfileElement()</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00541">icXYZArray::data</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00887">icXYZType::data</a>, <a class="el" href="../../d0/d6/lh__core_2fragment_8c-source.html#l00389">doubMatrixInvert()</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00306">icAbsoluteColorimetric</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00143">icSigBlueColorantTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00156">icSigGreenColorantTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00161">icSigMediaWhitePointTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00177">icSigRedColorantTag</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00056">kNumOfRGBchannels</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d4/d6/lh__core_2typedefs_8h-source.html#l00197">Matrix2D</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00046">CMLutParam::matrixTRC</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00100">LHCombiData::renderingIntent</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00760">icTagBase::sig</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00038">SINT8</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01421">ExtractAll_TRC_Luts()</a>.
<p>
<pre class="fragment"><div>01326 {
01327         <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a>               colorantData[<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a16">kNumOfRGBchannels</a>];
01328         <a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a>               curMediaWhite;
01329         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a15">Matrix2D</a>                localMatrix;
01330         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a15">Matrix2D</a>                invertMatrix;
01331         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>                  colorantTags[<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a16">kNumOfRGBchannels</a>];
01332         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                 err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01333         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>                   aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01334         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  loop;
01335         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  i;
01336         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>                  j;
01337         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>                  elementSize;
01338         <span class="keywordtype">double</span>                  factor;
01339 
01340         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"Extract_TRC_Matrix"</span>)
01341 
01342         <span class="comment">/* -----------------------------------------------------------------initialize */</span>
01343         colorantTags[0] = icSigRedColorantTag;
01344         colorantTags[1] = icSigGreenColorantTag;
01345         colorantTags[2] = icSigBlueColorantTag;
01346                 
01347         <span class="comment">/* ---------------------------------------------------------------------------------</span>
01348 <span class="comment">                take Matrix     from profile</span>
01349 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
01350         for (loop = 0; loop &lt; kNumOfRGBchannels; loop++)
01351         {
01352                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, colorantTags[loop], &amp;elementSize, nil);
01353                 <span class="keywordflow">if</span> (err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
01354                         <span class="keywordflow">goto</span> CleanupAndExit;
01355                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, colorantTags[loop], &amp;elementSize, &amp;colorantData[loop]);
01356 <span class="preprocessor">#ifdef IntelMode</span>
01357 <span class="preprocessor"></span>        SwapLongOffset( &amp;colorantData[loop].base.sig, 0, 4 );
01358         SwapLongOffset( &amp;colorantData[loop], (ULONG)((SINT8*)&amp;colorantData[0].data.data[0]-(SINT8*)&amp;colorantData[0]), elementSize );
01359 <span class="preprocessor">#endif</span>
01360 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
01361                         <span class="keywordflow">goto</span> CleanupAndExit;
01362                 localMatrix[0][loop] = ((<span class="keywordtype">double</span>)colorantData[loop].<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>) / 65536.    / 2.;
01363                 localMatrix[1][loop] = ((<span class="keywordtype">double</span>)colorantData[loop].<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>) / 65536.    / 2.;
01364                 localMatrix[2][loop] = ((<span class="keywordtype">double</span>)colorantData[loop].<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>) / 65536.    / 2.;
01365         }
01366         
01367         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o5">renderingIntent</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>)
01368         {
01369                 elementSize = <span class="keyword">sizeof</span>(<a class="code" href="../../d9/d6/structicXYZType.html">icXYZType</a>);
01370                 err = <a class="code" href="../../d7/d3/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c.html#a1">CMGetProfileElement</a>(theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o0">theProfile</a>, icSigMediaWhitePointTag, &amp;elementSize, &amp;curMediaWhite);
01371 <span class="preprocessor">#ifdef IntelMode</span>
01372 <span class="preprocessor"></span>        SwapLongOffset( &amp;curMediaWhite.<a class="code" href="../../d9/d6/structicXYZType.html#o0">base</a>.<a class="code" href="../../d6/d4/structicTagBase.html#o0">sig</a>, 0, 4 );
01373         SwapLongOffset( &amp;curMediaWhite, (ULONG)((SINT8*)&amp;curMediaWhite.<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0]-(SINT8*)&amp;curMediaWhite), elementSize );
01374 <span class="preprocessor">#endif</span>
01375 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (err != <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a38">cmElementTagNotFound</a>)                <span class="comment">/* otherwise take D50 -&gt; do nothing */</span>
01376                 {
01377                         <span class="keywordflow">if</span> (err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
01378                                 <span class="keywordflow">goto</span> CleanupAndExit;
01379                 
01380                         <span class="keywordflow">for</span> (i=0; i&lt;3; i++)             <span class="comment">/* adjust for media white point */</span>
01381                         {
01382                                 <span class="keywordflow">if</span> (i == 0)                                                                     <span class="comment">/* divide X by D50 white X */</span>
01383                                         factor = ((<span class="keywordtype">double</span>)curMediaWhite.<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o0">X</a>) / 65536. / 0.9642;
01384                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i == 1)
01385                                         factor = ((<span class="keywordtype">double</span>)curMediaWhite.<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o1">Y</a>) / 65536.;
01386                                 <span class="keywordflow">else</span>                                                                            <span class="comment">/* divide Z by D50 white Z */</span>
01387                                         factor = ((<span class="keywordtype">double</span>)curMediaWhite.<a class="code" href="../../d9/d6/structicXYZType.html#o1">data</a>.<a class="code" href="../../d7/d6/structicXYZArray.html#o0">data</a>[0].<a class="code" href="../../d8/d6/structicXYZNumber.html#o2">Z</a>) / 65536. / 0.8249;
01388                                 
01389                                 <span class="keywordflow">for</span> (j=0; j&lt;3; j++)
01390                                         localMatrix[i][j] *= factor;
01391                         }
01392                 }
01393         }
01394         
01395         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01396         {
01397                 <a class="code" href="../../d1/d6/w98_2lh__core_2memlink_8c.html#a24">doubMatrixInvert</a>(localMatrix, invertMatrix);
01398                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(invertMatrix, localMatrix, 9 * <span class="keyword">sizeof</span>(<span class="keywordtype">double</span>));
01399         }
01400         
01401         theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a> = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(<span class="keyword">sizeof</span>(Matrix2D), &amp;aOSerr);
01402         err = aOSerr;
01403         <span class="keywordflow">if</span> (err)
01404                 <span class="keywordflow">goto</span> CleanupAndExit;
01405         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(localMatrix, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o11">matrixTRC</a>, <span class="keyword">sizeof</span>(Matrix2D));
01406         <span class="comment">/* ---------------------------------------------------------------------------------</span>
01407 <span class="comment">            clean up &amp; exit</span>
01408 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
01409 CleanupAndExit:
01410 
01411         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"Extract_TRC_Matrix"</span>)
01412         return err;
01413 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a14" doxytag="w98/lh_core/genluts.h::ExtractAll_MFT_Luts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> ExtractAll_MFT_Luts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theTag</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00973">973</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00110">LHCombiData::amIPCS</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00059">CMGetProfileElement()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00097">LHCombiData::dataColorSpace</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00830">Extract_MFT_Alut()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00512">Extract_MFT_Elut()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00673">Extract_MFT_Xlut()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00454">GetMatrixFromProfile()</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00247">icSigXYZData</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00098">LHCombiData::profileConnectionSpace</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01762">ExtractAllLuts()</a>.
<p>
<pre class="fragment"><div>00976 {
00977         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>         err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00978         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>           aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00979         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a28">Ptr</a>                     profileLutPtr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00980         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>          elementSize;
00981         <span class="keywordtype">double</span>          factor;
00982         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>          byteCount;
00983 
00984         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"ExtractAll_MFT_Luts"</span>)
00985 
00986         <span class="comment">/* -------------------------------------------------------- get partial tag data from profile */</span>
00987         err = CMGetProfileElement(theCombiData-&gt;theProfile, theTag, &amp;elementSize, nil);
00988         if (err)
00989                 goto CleanupAndExit;
00990         
00991         byteCount = 52;                                                                                 <span class="comment">/* get the first 52 bytes out of the profile */</span>
00992         profileLutPtr = SmartNewPtr(byteCount, &amp;aOSerr);
00993         err = aOSerr;
00994         if (err)
00995                 goto CleanupAndExit;
00996         
00997     err = CMGetProfileElement(theCombiData-&gt;theProfile, theTag, &amp;byteCount, profileLutPtr);
00998 #ifdef IntelMode
00999     SwapLongOffset( &amp;((<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a>*)profileLutPtr)-&gt;base.sig, 0, 4 );
01000     SwapShortOffset( &amp;((<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a>*)profileLutPtr)-&gt;lut.inputEnt, 0, 2 );
01001     SwapShortOffset( &amp;((<a class="code" href="../../d7/d2/structicLut16Type.html">icLut16Type</a>*)profileLutPtr)-&gt;lut.outputEnt, 0, 2 );
01002 #endif
01003         if (err)
01004                 goto CleanupAndExit;
01005 
01006         theLutData-&gt;colorLutInDim               = ((<a class="code" href="../../d9/d2/structicLut8Type.html">icLut8Type</a>*)profileLutPtr)-&gt;lut.inputChan;
01007         theLutData-&gt;colorLutOutDim              = ((<a class="code" href="../../d9/d2/structicLut8Type.html">icLut8Type</a>*)profileLutPtr)-&gt;lut.outputChan;
01008         theLutData-&gt;colorLutGridPoints  = ((<a class="code" href="../../d9/d2/structicLut8Type.html">icLut8Type</a>*)profileLutPtr)-&gt;lut.clutPoints;
01009         
01010         <span class="comment">/* ---------------------------------------------------------------------- handle matrix</span>
01011 <span class="comment">                matrix is only used if:</span>
01012 <span class="comment">                 number of input channels is 3 and</span>
01013 <span class="comment">                 input is XYZ</span>
01014 <span class="comment">                matrix is identity for output when pcs == Lab</span>
01015 <span class="comment">        */</span>
01016         if ( ( theLutData-&gt;colorLutInDim == 3) &amp;&amp;
01017                ( (  theCombiData-&gt;amIPCS &amp;&amp; (theCombiData-&gt;profileConnectionSpace == icSigXYZData) ) ||
01018                  ( !theCombiData-&gt;amIPCS &amp;&amp; (theCombiData-&gt;dataColorSpace                 == icSigXYZData) ) ) )
01019         {
01020                 factor = 1.;
01021                 err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a20">GetMatrixFromProfile</a>(theLutData, theCombiData, theTag, factor);
01022         }
01023         
01024         <span class="comment">/* ---------------------------------------------------------------------- process A Lut */</span>
01025         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a13">Extract_MFT_Alut</a>( theLutData, theCombiData, profileLutPtr, theTag );
01026         <span class="keywordflow">if</span> (err)
01027                 <span class="keywordflow">goto</span> CleanupAndExit;
01028         
01029         <span class="comment">/* ---------------------------------------------------------------------- process X Lut */</span>
01030         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a11">Extract_MFT_Xlut</a> ( theLutData, theCombiData, profileLutPtr, theTag );
01031         <span class="keywordflow">if</span> (err)
01032                 <span class="keywordflow">goto</span> CleanupAndExit;
01033         
01034         <span class="comment">/* ---------------------------------------------------------------------- process E Lut */</span>
01035         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a12">Extract_MFT_Elut</a>( theLutData, theCombiData, profileLutPtr, theTag );
01036         <span class="keywordflow">if</span> (err)
01037                 <span class="keywordflow">goto</span> CleanupAndExit;
01038 
01039         <span class="comment">/* ---------------------------------------------------------------------------------</span>
01040 <span class="comment">                 clean up</span>
01041 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
01042 CleanupAndExit:
01043         profileLutPtr = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>(profileLutPtr);
01044 
01045         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"ExtractAll_MFT_Luts"</span>)
01046         return err;
01047 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a18" doxytag="w98/lh_core/genluts.h::ExtractAll_TRC_Luts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> ExtractAll_TRC_Luts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01421">1421</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01057">Extract_TRC_Alut()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01190">Extract_TRC_Elut()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01324">Extract_TRC_Matrix()</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00056">kNumOfRGBchannels</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, and <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01762">ExtractAllLuts()</a>.
<p>
<pre class="fragment"><div>01423 {
01424         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a> err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01425         
01426         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"ExtractAll_TRC_Luts"</span>)
01427         
01428         theLutData-&gt;colorLutInDim = kNumOfRGBchannels;
01429         theLutData-&gt;colorLutOutDim = kNumOfRGBchannels;
01430                         
01431         <span class="comment">/* ------------------------------------------------------------------------- process A lut */</span>
01432         err = Extract_TRC_Alut( theLutData, theCombiData);
01433         if (err != noErr)
01434                 goto CleanupAndExit;
01435                 
01436         <span class="comment">/* ------------------------------------------------------------------------- process matrix */</span>
01437         err = Extract_TRC_Matrix ( theLutData, theCombiData);
01438         if (err != noErr)
01439                 goto CleanupAndExit;
01440                 
01441         <span class="comment">/* ------------------------------------------------------------------------- process E lut */</span>
01442         err = Extract_TRC_Elut( theLutData, theCombiData);
01443         if (err != noErr)
01444                 goto CleanupAndExit;
01445                 
01446         <span class="comment">/* ---------------------------------------------------------------------------------</span>
01447 <span class="comment">            clean up</span>
01448 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
01449 CleanupAndExit:
01450 
01451         LH_END_PROC("ExtractAll_TRC_Luts")
01452         return err;
01453 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a21" doxytag="w98/lh_core/genluts.h::ExtractAllLuts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> ExtractAllLuts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01762">1762</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00110">LHCombiData::amIPCS</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00097">LHCombiData::dataColorSpace</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00109">LHCombiData::doCreateGamutLut</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00380">DoMakeGamutForMonitor()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01461">Extract_Gray_Luts()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00973">ExtractAll_MFT_Luts()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01421">ExtractAll_TRC_Luts()</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00306">icAbsoluteColorimetric</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00303">icPerceptual</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00304">icRelativeColorimetric</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00305">icSaturation</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00268">icSigAbstractClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00139">icSigAToB0Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00140">icSigAToB1Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00141">icSigAToB2Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00145">icSigBToA0Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00146">icSigBToA1Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00147">icSigBToA2Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00256">icSigCmykData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00269">icSigColorSpaceClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00265">icSigDisplayClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00154">icSigGamutTag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00253">icSigGrayData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00264">icSigInputClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00267">icSigLinkClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00266">icSigOutputClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00163">icSigPreview0Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00164">icSigPreview1Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00165">icSigPreview2Tag</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00252">icSigRgbData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00247">icSigXYZData</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00070">OSType</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00096">LHCombiData::profileClass</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00098">LHCombiData::profileConnectionSpace</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00100">LHCombiData::renderingIntent</a>, and <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00111">LHCombiData::usePreviewTag</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l02423">CreateCombi()</a>.
<p>
<pre class="fragment"><div>01764 {
01765         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>         err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
01766         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a34">OSType</a>          theTag;
01767 
01768         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"ExtractAllLuts"</span>)
01769 
01770         <span class="comment">/* --------------------------------------------------------------------------------- find out what tag to use... */</span>
01771         if ( theCombiData-&gt;doCreateGamutLut )
01772                 theTag = icSigGamutTag;
01773         else
01774         {
01775                 <span class="keywordflow">switch</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o5">renderingIntent</a>)
01776                 {
01777                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a>:                              <span class="comment">/* Photographic images */</span>
01778                                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o16">usePreviewTag</a>)
01779                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a41">icSigPreview0Tag</a>;
01780                                 <span class="keywordflow">else</span>
01781                                 {
01782                                         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01783                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a23">icSigBToA0Tag</a>;
01784                                         <span class="keywordflow">else</span>
01785                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>;
01786                                 }
01787                                 <span class="keywordflow">break</span>;
01788                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a143">icRelativeColorimetric</a>:    <span class="comment">/* Logo Colors */</span>
01789                                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o16">usePreviewTag</a>)
01790                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a42">icSigPreview1Tag</a>;
01791                                 <span class="keywordflow">else</span>
01792                                 {
01793                                         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01794                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a24">icSigBToA1Tag</a>;
01795                                         <span class="keywordflow">else</span>
01796                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a18">icSigAToB1Tag</a>;
01797                                 }
01798                                 <span class="keywordflow">break</span>;
01799                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a144">icSaturation</a>:                              <span class="comment">/* Business graphics */</span>
01800                                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o16">usePreviewTag</a>)
01801                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a43">icSigPreview2Tag</a>;
01802                                 <span class="keywordflow">else</span>
01803                                 {
01804                                         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01805                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a25">icSigBToA2Tag</a>;
01806                                         <span class="keywordflow">else</span>
01807                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a19">icSigAToB2Tag</a>;
01808                                 }
01809                                 <span class="keywordflow">break</span>;
01810                         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a145">icAbsoluteColorimetric</a>:    <span class="comment">/* Logo Colors */</span>
01811                                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o16">usePreviewTag</a>)
01812                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a42">icSigPreview1Tag</a>;
01813                                 <span class="keywordflow">else</span>
01814                                 {
01815                                         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01816                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a24">icSigBToA1Tag</a>;
01817                                         <span class="keywordflow">else</span>
01818                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a18">icSigAToB1Tag</a>;
01819                                 }
01820                                 <span class="keywordflow">break</span>;
01821                         <span class="keywordflow">default</span>:
01822                                 err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
01823                                 <span class="keywordflow">break</span>;
01824                 }
01825         }
01826 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
01827 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
01828                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  ExtractAllLuts: theTag = '%4.4s'=0x%08X (renderingIntent = %d)\n"</span>,  &amp;theTag, theTag, theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o5">renderingIntent</a> );
01829 <span class="preprocessor">#endif</span>
01830 <span class="preprocessor"></span>
01831         <span class="keywordflow">switch</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o1">profileClass</a>)
01832         {
01833                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01834 <span class="comment">                        input profile</span>
01835 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01836                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a122">icSigInputClass</a>:
01837                         <span class="keywordflow">switch</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o2">dataColorSpace</a>)
01838                         {
01839                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a115">icSigGrayData</a>:                                                                                                                                             <span class="comment">/*  Gray Input Profile */</span>
01840                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a19">Extract_Gray_Luts</a>( theLutData, theCombiData);
01841                                         <span class="keywordflow">break</span>;
01842                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a>:                                                                                                                                                      <span class="comment">/*  RGB Input Profile */</span>
01843                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, theTag );
01844                                         <span class="keywordflow">if</span> ( err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a> &amp;&amp; theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o5">renderingIntent</a> != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a> )
01845                                         {
01846                                                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01847                                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a23">icSigBToA0Tag</a>;
01848                                                 <span class="keywordflow">else</span>
01849                                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>;
01850 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
01851 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
01852                                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" 'scnr': ExtractAll_MFT_Luts failed - continuing with '%4.4s'...\n"</span>, &amp;theTag);
01853 <span class="preprocessor">#endif</span>
01854 <span class="preprocessor"></span>                                                err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, theTag );
01855                                         }
01856                                         <span class="keywordflow">if</span> (( err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a> ) &amp;&amp; (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a> ))
01857                                         {
01858                                                 <span class="comment">/* XYZ and no mft -&gt; try matrix/TRC: */</span>
01859 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
01860 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
01861                                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" 'scnr': ExtractAll_MFT_Luts failed - continuing with TRC...\n"</span>);
01862 <span class="preprocessor">#endif</span>
01863 <span class="preprocessor"></span>                                                err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a18">ExtractAll_TRC_Luts</a>( theLutData, theCombiData );
01864                                         }
01865                                         <span class="keywordflow">break</span>;
01866                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a118">icSigCmykData</a>:                                                                                                                                             <span class="comment">/* CMYK */</span>
01867                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, theTag );
01868                                         <span class="keywordflow">if</span> ( err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a> &amp;&amp; theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o5">renderingIntent</a> != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a142">icPerceptual</a> )
01869                                         {
01870                                                 <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01871                                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a23">icSigBToA0Tag</a>;
01872                                                 <span class="keywordflow">else</span>
01873                                                         theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>;
01874 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
01875 <span class="preprocessor"></span>                                                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
01876                                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" 'scnr': ExtractAll_MFT_Luts failed - continuing with '%4.4s'...\n"</span>, &amp;theTag);
01877 <span class="preprocessor">#endif</span>
01878 <span class="preprocessor"></span>                                                err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, theTag );
01879                                         }
01880                                         <span class="keywordflow">break</span>;
01881                                 <span class="keywordflow">default</span>:                                                                                                                                                                <span class="comment">/* this covers also: cmHSVData, cmHLSData, cmCMYData */</span>
01882                                         <span class="comment">/* CMYK Input Profile must have an A2B0Tag (see page 17 InterColor Profile Format) */</span>
01883                                         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01884                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a23">icSigBToA0Tag</a>;
01885                                         <span class="keywordflow">else</span>
01886                                                 theTag = <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a17">icSigAToB0Tag</a>;
01887                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, theTag );
01888                                         <span class="keywordflow">break</span>;
01889                         }
01890                         <span class="keywordflow">break</span>;
01891                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01892 <span class="comment">                        display profile</span>
01893 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01894                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a123">icSigDisplayClass</a>:
01895                         <span class="keywordflow">switch</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o2">dataColorSpace</a>)
01896                         {
01897                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a115">icSigGrayData</a>:                                                                                                                                             <span class="comment">/*  Gray display Profile */</span>
01898                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a19">Extract_Gray_Luts</a>( theLutData, theCombiData);
01899                                         <span class="keywordflow">break</span>;
01900                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a>:                                                                                                                                                      <span class="comment">/*  RGB display Profile */</span>
01901                                         <span class="keywordflow">if</span> ( theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o14">doCreateGamutLut</a>)
01902                                         {
01903                                                 err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a10">DoMakeGamutForMonitor</a>( theLutData, theCombiData );
01904                                         } <span class="keywordflow">else</span>
01905                                         {
01906                                                 err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>(theLutData, theCombiData, theTag);
01907                                                 <span class="keywordflow">if</span> (( err != <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a> ) &amp;&amp; (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o3">profileConnectionSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a> ))
01908                                                 {
01909                                                         <span class="comment">/* XYZ and no mft -&gt; try matrix/TRC: */</span>
01910 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
01911 <span class="preprocessor"></span>                                                        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
01912                                                                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" 'mntr': ExtractAll_MFT_Luts failed - continuing with TRC...\n"</span>);
01913 <span class="preprocessor">#endif</span>
01914 <span class="preprocessor"></span>                                                        err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a18">ExtractAll_TRC_Luts</a>( theLutData, theCombiData );
01915                                                 }
01916                                         }
01917                                         <span class="keywordflow">break</span>;
01918                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a118">icSigCmykData</a>:
01919                                 <span class="keywordflow">default</span>:                                                                                                                                                                <span class="comment">/* this covers: cmCMYK, cmHSVData, cmHLSData, cmCMYData */</span>
01920                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>(theLutData, theCombiData, theTag);
01921                                         <span class="keywordflow">break</span>;
01922                         }
01923                         <span class="keywordflow">break</span>;
01924                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01925 <span class="comment">                        output profile</span>
01926 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01927                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a124">icSigOutputClass</a>:
01928                         <span class="keywordflow">switch</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o2">dataColorSpace</a>)
01929                         {
01930                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a115">icSigGrayData</a>:                                                                                                                                             <span class="comment">/*  Gray output Profile */</span>
01931                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a19">Extract_Gray_Luts</a>( theLutData, theCombiData );
01932                                         <span class="keywordflow">break</span>;
01933                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a>:                                                                                                                                                      <span class="comment">/*  RGB output Profile */</span>
01934                                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a118">icSigCmykData</a>:                                                                                                                                             <span class="comment">/*  CMYK output Profile */</span>
01935                                 <span class="keywordflow">default</span>:                                                                                                                                                                <span class="comment">/*  this covers also: cmHSVData, cmHLSData, cmCMYData*/</span>
01936                                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, theTag );
01937                                         <span class="keywordflow">break</span>;
01938                         }
01939                         <span class="keywordflow">break</span>;
01940                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01941 <span class="comment">                        DeviceLink profile</span>
01942 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01943                 <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a125">icSigLinkClass</a>:
01944                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, icSigAToB0Tag );
01945                         <span class="keywordflow">break</span>;
01946                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01947 <span class="comment">                        ColorSpaceConversion profile</span>
01948 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01949         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a127">icSigColorSpaceClass</a>:              <span class="comment">/* 'spac' */</span>
01950                         <span class="keywordflow">if</span> (theCombiData-&gt;<a class="code" href="../../d3/d8/structLHCombiData.html#o15">amIPCS</a>)
01951                                 err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, icSigBToA0Tag );
01952                         <span class="keywordflow">else</span>
01953                                 err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, icSigAToB0Tag );
01954                         <span class="keywordflow">break</span>;
01955                 <span class="comment">/* ---------------------------------------------------------------------------------</span>
01956 <span class="comment">                        Abstract profile</span>
01957 <span class="comment">                   ---------------------------------------------------------------------------------*/</span>
01958         <span class="keywordflow">case</span> <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a126">icSigAbstractClass</a>:                <span class="comment">/* 'abst' */</span>
01959                         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a14">ExtractAll_MFT_Luts</a>( theLutData, theCombiData, icSigAToB0Tag );
01960                         <span class="keywordflow">break</span>;
01961                 <span class="keywordflow">default</span>:
01962                         err = <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a149a31">cmProfileError</a>;
01963                         <span class="keywordflow">break</span>;
01964         }
01965 
01966         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"ExtractAllLuts"</span>)
01967         return err;
01968 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="w98/lh_core/genluts.h::FillLuts" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> FillLuts           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a14">CMMModelHandle</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CMSession</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a13">CMProfileRef</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>srcProfile</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a13">CMProfileRef</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>dstProfile</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a20" doxytag="w98/lh_core/genluts.h::GetMatrixFromProfile" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> GetMatrixFromProfile           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d0/d4/structCMLutParam.html">CMLutParamPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theLutData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d3/d8/structLHCombiData.html">LHCombiDataPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theCombiData</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d5/d6/w98_2lh__open_2pi__basic_8h.html#a34">OSType</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>theTag</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>double&nbsp;</td>
          <td class="mdname" nowrap> <em>factor</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00454">454</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00056">BlockMoveData</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00085">CMGetPartialProfileElement()</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00069">Fixed</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d4/d6/lh__core_2typedefs_8h-source.html#l00197">Matrix2D</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00047">CMLutParam::matrixMFT</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00071">OSErr</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00040">SINT32</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00047">SmartNewPtr()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00095">LHCombiData::theProfile</a>, and <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00032">UINT32</a>.
<p>
Referenced by <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l00973">ExtractAll_MFT_Luts()</a>, and <a class="el" href="../../d7/d5/lh__open_2pi__cmm_8c-source.html#l00342">MakeSessionFromLink()</a>.
<p>
<pre class="fragment"><div>00458 {
00459         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>         err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00460         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a35">OSErr</a>           aOSerr = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
00461         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          i;
00462         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          j;
00463         <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a15">Matrix2D</a>        localMatrix;
00464         <span class="keywordtype">long</span>            matrix[3][3];
00465         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a8">UINT32</a>          byteCount;
00466         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a14">SINT32</a>          offset;
00467         
00468         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"GetMatrixFromProfile"</span>)
00469         
00470         <span class="comment">/* -------------------------------------------------------- get tag data from profile */</span>
00471         offset    = 12; <span class="comment">/* matrix starts at byte 12 */</span>
00472         byteCount = 9 * sizeof(Fixed);
00473         err = CMGetPartialProfileElement(theCombiData-&gt;theProfile, theTag, offset, &amp;byteCount, &amp;matrix);
00474 #ifdef IntelMode
00475         SwapLongOffset( &amp;matrix, 0, byteCount );
00476 #endif
00477         if (err)
00478                 goto CleanupAndExit;
00479         
00480         for (i = 0; i &lt; 3; i++)
00481                 for (j = 0; j &lt; 3; j++)
00482                         localMatrix[i][j] =  (<span class="keywordtype">double</span>)( matrix[i][j] / 65536.0 * factor);
00483         
00484         if ( 0  || localMatrix[0][0] + localMatrix[1][1] + localMatrix[2][2] != 3.0 )           <span class="comment">/* ignore ident */</span>
00485         {
00486                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a> = <a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a5">SmartNewPtr</a>(<span class="keyword">sizeof</span>(Matrix2D), &amp;aOSerr);
00487                 err = aOSerr;
00488                 <span class="keywordflow">if</span> (err)
00489                         <span class="keywordflow">goto</span> CleanupAndExit;
00490                 <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a3">BlockMoveData</a>(localMatrix, theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a>, <span class="keyword">sizeof</span>(Matrix2D));
00491         }
00492         <span class="keywordflow">else</span>
00493                 theLutData-&gt;<a class="code" href="../../d0/d4/structCMLutParam.html#o12">matrixMFT</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
00494         <span class="comment">/* ---------------------------------------------------------------------------------</span>
00495 <span class="comment">            clean up</span>
00496 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
00497 CleanupAndExit:
00498 
00499         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"GetMatrixFromProfile"</span>)
00500         return err;
00501 }
</div></pre>    </td>
  </tr>
</table>
<a class="anchor" name="a24" doxytag="w98/lh_core/genluts.h::PrepareCombiLUTs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="../../d3/d6/w98_2lh__open_2pi__app_8h.html#a11">CMError</a> PrepareCombiLUTs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="../../d4/d7/w98_2lh__core_2typedefs_8h.html#a13">CMMModelPtr</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>CMSession</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="../../d9/d3/structCMConcatProfileSet.html">CMConcatProfileSet</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>profileSet</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l03432">3432</a> of file <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html">lh_core/genluts.c</a>.
<p>
References <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00050">Boolean</a>, <a class="el" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00023">CMError</a>, <a class="el" href="../../d8/d2/ntgdi_2icm_2mscmm_8w98_2mscmm_2access_8c-source.html#l00030">CMGetProfileHeader()</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00043">CMLutParam::colorLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00041">CMLutParam::colorLutGridPoints</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00039">CMLutParam::colorLutInDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00040">CMLutParam::colorLutOutDim</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00042">CMLutParam::colorLutWordSize</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00916">icHeader::colorSpace</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00137">LHConcatProfileSet::count</a>, <a class="el" href="../../d4/d5/w98_2lh__open_2pi__app_8h-source.html#l00171">CMConcatProfileSet::count</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l01999">Create_LH_ProfileSet()</a>, <a class="el" href="../../d1/d0/lh__core_2genluts_8c-source.html#l02423">CreateCombi()</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00038">DATA_2_PTR</a>, <a class="el" href="../../d8/d1/drivesup_8c-source.html#l00052">DebugPrint</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00915">icHeader::deviceClass</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00045">DISPOSE_IF_DATA</a>, <a class="el" href="../../d7/d6/lh__open_2pi__mem_8c-source.html#l00099">DisposeIfPtr()</a>, <a class="el" href="../../d4/d7/propapi_8h-source.html#l00043">dwFlags</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00625">FALSE</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00921">icHeader::flags</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00265">icSigDisplayClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00267">icSigLinkClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00266">icSigOutputClass</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00252">icSigRgbData</a>, <a class="el" href="../../d8/d3/aug98_2dll32_2icc_8h-source.html#l00247">icSigXYZData</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00035">CMLutParam::inputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00033">CMLutParam::inputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00034">CMLutParam::inputLutWordSize</a>, <a class="el" href="../../d6/d9/lh__open_2general_8h.html#a94a89">kCMMNewLinkProfile</a>, <a class="el" href="../../d3/d5/lh__open_2pi__app_8h-source.html#l00333">kCreateGamutLutMask</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00049">kDoDefaultLut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00050">kDoGamutLut</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00054">kDoLab2XYZ</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00053">LH_END_PROC</a>, <a class="el" href="../../d7/d8/lh__open_2general_8h-source.html#l00052">LH_START_PROC</a>, <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00041">LOCK_DATA</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a>, <a class="el" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a17">NamedColorProfileOnly</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00020">nil</a>, <a class="el" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00038">CMLutParam::outputLut</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00036">CMLutParam::outputLutEntryCount</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00037">CMLutParam::outputLutWordSize</a>, <a class="el" href="../../d6/d6/mscmm_8w98_2lh__core_2profile_8h-source.html#l00917">icHeader::pcs</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00126">LHProfile::pcsConversionMode</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00138">LHConcatProfileSet::prof</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00125">LHProfile::profileSet</a>, <a class="el" href="../../d4/d5/w98_2lh__open_2pi__app_8h-source.html#l00172">CMConcatProfileSet::profileSet</a>, <a class="el" href="../../d5/d5/lh__open_2pi__basic_8h-source.html#l00052">Ptr</a>, <a class="el" href="../../d5/d6/w98_2lh__core_2typedefs_8h-source.html#l00128">LHProfile::renderingIntent</a>, <a class="el" href="../../d7/d7/w98_2lh__open_2pi__mem_8c.html#a6">SetMem()</a>, <a class="el" href="../../d7/d6/halmips_8h-source.html#l00626">TRUE</a>, <a class="el" href="../../d0/d7/udf_8h-source.html#l00235">UINT16</a>, and <a class="el" href="../../d6/d5/lh__core_2defines_8h-source.html#l00042">UNLOCK_DATA</a>.
<p>
Referenced by <a class="el" href="../../d7/d5/lh__open_2pi__cmm_8c-source.html#l00197">CMMConcatInitPrivate()</a>, and <a class="el" href="../../d7/d5/lh__open_2pi__cmm_8c-source.html#l00060">CMMInitPrivate()</a>.
<p>
<pre class="fragment"><div>03434 {
03435         <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>                         firstHeader;
03436         <a class="code" href="../../d1/d2/structicHeader.html">icHeader</a>                         lastHeader;
03437         <a class="code" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a>*      newProfileSet = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;
03438         <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a11">CMError</a>                          err = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>;
03439         <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a21">Boolean</a>                          needGamutCalc  = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03440         <a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>                       theLutData;
03441         <a class="code" href="../../d9/d7/udf_8h.html#a24">UINT16</a>                           count;
03442         
03443         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a1">LH_START_PROC</a>(<span class="stringliteral">"PrepareCombiLUTs"</span>)
03444         <span class="comment">/*err = PrepareCombiLUTsNew     ( CMSession, profileSet );</span>
03445 <span class="comment">        LH_END_PROC("PrepareCombiLUTs")</span>
03446 <span class="comment">        return err;*/</span>
03447         SetMem(&amp;theLutData, sizeof(<a class="code" href="../../d0/d4/structCMLutParam.html">CMLutParam</a>), 0);
03448         count = profileSet-&gt;count;
03449 
03450         <span class="comment">/* ------------------------------------------------------------------------------------------------*/</span>
03451         err = CMGetProfileHeader(profileSet-&gt;profileSet[0], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;firstHeader);
03452         if (err)
03453                 goto CleanupAndExit;
03454         (CMSession)-&gt;firstColorSpace = firstHeader.colorSpace;
03455         
03456         err = CMGetProfileHeader(profileSet-&gt;profileSet[count-1], (<a class="code" href="../../d1/d2/structicHeader.html">CMCoreProfileHeader</a> *)&amp;lastHeader);
03457         if (err)
03458                 goto CleanupAndExit;
03459         (CMSession)-&gt;lastColorSpace = lastHeader.colorSpace;
03460         if( lastHeader.deviceClass == icSigLinkClass )
03461                 (CMSession)-&gt;lastColorSpace = lastHeader.pcs;
03462         else
03463                 (CMSession)-&gt;lastColorSpace = lastHeader.colorSpace;
03464 #ifdef ALLOW_DEVICE_LINK
03465         if( count &gt; 1 &amp;&amp; lastHeader.deviceClass == icSigLinkClass ){
03466                 (CMSession)-&gt;appendDeviceLink = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03467                 profileSet-&gt;count--;
03468         }
03469         <span class="keywordflow">else</span>{
03470                 (CMSession)-&gt;appendDeviceLink = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03471         }
03472 <span class="preprocessor">#endif</span>
03473 <span class="preprocessor"></span>        <span class="comment">/* ------------------------------------------------------------------------------------------------</span>
03474 <span class="comment">                right now we create the gamut-luts always if the last profile is a display -or- an output profile</span>
03475 <span class="comment">                (NO gamut-luts are created for a CMMNewLinkProfile-call).</span>
03476 <span class="comment">           ------------------------------------------------------------------------------------------------*/</span>
03477         <span class="keywordflow">if</span>  ( (lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a124">icSigOutputClass</a>) ||  (lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a123">icSigDisplayClass</a>) )
03478                 needGamutCalc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03479 
03480         <span class="keywordflow">if</span> ( (CMSession)-&gt;currentCall == <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a94a89">kCMMNewLinkProfile</a> )
03481                 needGamutCalc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03482                 
03483         <span class="comment">/* ------------------------------------------------------------------------------------------------</span>
03484 <span class="comment">                we could speed up the init-phase if we would use a flag in the first profile to indicate whether</span>
03485 <span class="comment">                or not the gamut-luts should be created:</span>
03486 <span class="comment">           ------------------------------------------------------------------------------------------------*/</span>
03487         <span class="keywordflow">if</span> ( (firstHeader.<a class="code" href="../../d1/d2/structicHeader.html#o9">flags</a> &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a4">kCreateGamutLutMask</a>) == <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a4">kCreateGamutLutMask</a>)
03488                 needGamutCalc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03489 
03490 <span class="preprocessor">#ifdef RenderInt</span>
03491 <span class="preprocessor"></span>        <span class="keywordflow">if</span>( CMSession-&gt; <a class="code" href="../../d3/d8/propapi_8h.html#a34">dwFlags</a> != 0xffffffff ){
03492                 <span class="keywordflow">if</span>( CMSession-&gt;dwFlags &amp; <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a4">kCreateGamutLutMask</a> ){
03493                         needGamutCalc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03494                 }
03495                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a124">icSigOutputClass</a> ||
03496                                  lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a123">icSigDisplayClass</a> )
03497                         needGamutCalc = <a class="code" href="../../d6/d7/halmips_8h.html#a458">TRUE</a>;
03498         }
03499 <span class="preprocessor">#endif</span>
03500 <span class="preprocessor"></span>        <span class="comment">/* ------------------------------------------------------------------------------------------------*/</span>
03501         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a22">Create_LH_ProfileSet</a>( CMSession, profileSet, &amp;newProfileSet);
03502         <span class="keywordflow">if</span> (err)
03503                 <span class="keywordflow">goto</span> CleanupAndExit;
03504         
03505 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03506 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( ! needGamutCalc &amp;&amp; DebugCheck(kThisFile, kDebugMiscInfo) )
03507         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"\n  &lt;=================== Gamut Combi is not created =================&gt;\n\n"</span>);
03508 <span class="preprocessor">#endif</span>
03509 <span class="preprocessor"></span>    <span class="comment">/*=============================================================================================*/</span>
03510     <span class="comment">/* Create Gamut Combi*/</span>
03511     <span class="comment">/*=============================================================================================*/</span>
03512         <span class="keywordflow">if</span>( CMSession-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a17">NamedColorProfileOnly</a> ||
03513                 CMSession-&gt;hasNamedColorProf == <a class="code" href="../../d3/d7/lh__core_2typedefs_8h.html#a20a19">NamedColorProfileAtEnd</a> )needGamutCalc = <a class="code" href="../../d6/d7/halmips_8h.html#a457">FALSE</a>;
03514     <span class="keywordflow">if</span> (needGamutCalc)
03515     {
03516 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03517 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
03518             <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  &lt;======================= Create Gamut Combi =====================&gt;\n"</span>);
03519 <span class="preprocessor">#endif</span>
03520 <span class="preprocessor"></span>                <span class="keywordflow">if</span>( lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a> != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a> &amp;&amp;                   <span class="comment">/* since there's only a makeGamutForMonitor for xyz */</span>
03521                         lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a123">icSigDisplayClass</a> &amp;&amp;
03522                         lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a> ){        <span class="comment">/* insert a Lab-&gt;XYZ conversion */</span>
03523                                                                                         
03524                         newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>] = newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1];
03525                         newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1].<a class="code" href="../../d5/d8/structLHProfile.html#o1">pcsConversionMode</a> = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a15">kDoLab2XYZ</a>;             <span class="comment">/* create Lab-&gt;XYZ */</span>
03526                         newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1].<a class="code" href="../../d5/d8/structLHProfile.html#o0">profileSet</a> = 0;
03527                         newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1].<a class="code" href="../../d5/d8/structLHProfile.html#o3">renderingIntent</a> = 0;
03528                         newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>++;
03529                 }
03530                 err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a23">CreateCombi</a>(CMSession, profileSet, newProfileSet, &amp;theLutData, kDoGamutLut );
03531                 <span class="keywordflow">if</span>( lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o5">pcs</a> != <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a109">icSigXYZData</a> &amp;&amp;                   <span class="comment">/* since there's only a makeGamutForMonitor for xyz */</span>
03532                         lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o3">deviceClass</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a123">icSigDisplayClass</a> &amp;&amp;
03533                         lastHeader.<a class="code" href="../../d1/d2/structicHeader.html#o4">colorSpace</a> == <a class="code" href="../../d7/d4/aug98_2dll32_2icc_8h.html#a114">icSigRgbData</a> ){                        <span class="comment">/* remove a Lab-&gt;XYZ conversion */</span>      
03534 
03535                         newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>--;
03536                         newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>-1] = newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o2">prof</a>[newProfileSet-&gt;<a class="code" href="../../d4/d8/structLHConcatProfileSet.html#o1">count</a>];
03537                 }
03538                 <span class="comment">/* continue even if err != noErr !!!!*/</span>
03539 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03540 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ( err &amp;&amp; DebugCheck(kThisFile, kDebugErrorInfo) )
03541                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" Error: PrepareCombiLUTs - kDoGamutLut: %d\n"</span>,err);
03542 <span class="preprocessor">#endif</span>
03543 <span class="preprocessor"></span>                
03544                 <span class="keywordflow">if</span> (err == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a58a55">noErr</a>)
03545                 {
03546 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03547 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (DebugLutCheck(kDisplayEXAGamut) )
03548                         {
03549                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03550                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03551                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03552                                 DoDisplayLutNew(<span class="stringliteral">"\pFINAL GAMUT E Lut"</span>, &amp;theLutData, 0);
03553                                 DoDisplayLutNew(<span class="stringliteral">"\pFINAL GAMUT A Lut"</span>, &amp;theLutData, 2);
03554                                 DoDisplayLutNew(<span class="stringliteral">"\pFINAL GAMUT X Lut"</span>, &amp;theLutData, 1);
03555                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03556                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03557                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03558                         }
03559                         <span class="keywordflow">if</span> ( DebugLutCheck( kDisplayGamut ) )
03560                         {
03561                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03562                                 <span class="keywordflow">if</span> ((CMSession)-&gt;precision == <a class="code" href="../../d2/d6/lh__open_2pi__app_8h.html#a153a116">cmBestMode</a>)
03563                                         Show32by32by32GamutXLUT(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>));
03564                                 <span class="keywordflow">else</span>
03565                                         Show16by16by16GamutXLUT(<a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a3">DATA_2_PTR</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>));
03566                                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03567                         }
03568 <span class="preprocessor">#endif</span>
03569 <span class="preprocessor"></span>                        <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
03570                         {
03571 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03572 <span class="preprocessor"></span>                                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
03573                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" ERROR: final Gamut Elut == nil\n"</span>);
03574 <span class="preprocessor">#endif</span>
03575 <span class="preprocessor"></span>                        } <span class="keywordflow">else</span>
03576                         {
03577                                 (CMSession)-&gt;gamutLutParam.inputLut = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>;                                                                                              <span class="comment">/* E lut */</span>
03578                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;      
03579                         }
03580                         
03581                         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
03582                         {
03583 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03584 <span class="preprocessor"></span>                                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
03585                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" ERROR: final Gamut Alut == nil\n"</span>);
03586 <span class="preprocessor">#endif</span>
03587 <span class="preprocessor"></span>                        } <span class="keywordflow">else</span>
03588                         {
03589                                 (CMSession)-&gt;gamutLutParam.outputLut = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>;                                                                                    <span class="comment">/* A lut */</span>
03590                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;     
03591                         }
03592                         
03593                         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
03594                         {
03595 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03596 <span class="preprocessor"></span>                                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
03597                                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" ERROR: final Gamut Xlut == nil\n"</span>);
03598 <span class="preprocessor">#endif</span>
03599 <span class="preprocessor"></span>                        } <span class="keywordflow">else</span>
03600                         {
03601                                 (CMSession)-&gt;gamutLutParam.colorLut = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>;                                                                                              <span class="comment">/* X lut */</span>
03602                                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;      
03603                         }
03604                         (CMSession)-&gt;gamutLutParam.colorLutInDim                = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
03605                         (CMSession)-&gt;gamutLutParam.colorLutOutDim               = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
03606                         (CMSession)-&gt;gamutLutParam.colorLutGridPoints   = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>;
03607                         (CMSession)-&gt;gamutLutParam.colorLutWordSize             = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a>;
03608                         (CMSession)-&gt;gamutLutParam.inputLutWordSize             = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a>;
03609                         (CMSession)-&gt;gamutLutParam.outputLutWordSize    = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a>;
03610                         (CMSession)-&gt;gamutLutParam.inputLutEntryCount   = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>;
03611                         (CMSession)-&gt;gamutLutParam.outputLutEntryCount  = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a>;
03612                 }
03613                 <span class="keywordflow">else</span>{
03614                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>             = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03615                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>    = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03616                         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>             = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03617                 }
03618         }
03619         <span class="comment">/*=============================================================================================</span>
03620 <span class="comment">           Create 'real' Combi</span>
03621 <span class="comment">          =============================================================================================*/</span>
03622 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03623 <span class="preprocessor"></span>        <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugMiscInfo) )
03624                 <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">"  &lt;======================= Create real Combi ======================&gt;\n"</span>);
03625 <span class="preprocessor">#endif</span>
03626 <span class="preprocessor"></span>
03627         err = <a class="code" href="../../d3/d1/w98_2lh__core_2genluts_8h.html#a23">CreateCombi</a>(CMSession, profileSet, newProfileSet, &amp;theLutData, kDoDefaultLut );
03628         <span class="keywordflow">if</span> (err){
03629                 CMSession-&gt;theNamedColorTagData         = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>( CMSession-&gt;theNamedColorTagData);
03630                 CMSession-&gt;gamutLutParam.inputLut       = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>( CMSession-&gt;gamutLutParam.inputLut);
03631                 CMSession-&gt;gamutLutParam.outputLut      = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>( CMSession-&gt;gamutLutParam.outputLut);
03632                 CMSession-&gt;gamutLutParam.colorLut       = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>( CMSession-&gt;gamutLutParam.colorLut);
03633                 <span class="keywordflow">goto</span> CleanupAndExit;
03634         }
03635         
03636 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03637 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (DebugLutCheck(kDebugEXAReal) )
03638         {
03639                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03640                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03641                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03642                 DoDisplayLutNew(<span class="stringliteral">"\pFINAL E Lut"</span>, &amp;theLutData, 0);
03643                 DoDisplayLutNew(<span class="stringliteral">"\pFINAL A Lut"</span>, &amp;theLutData, 2);
03644                 DoDisplayLutNew(<span class="stringliteral">"\pFINAL X Lut"</span>, &amp;theLutData, 1);
03645                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03646                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03647                 <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03648         }
03649 <span class="preprocessor">#endif</span>
03650 <span class="preprocessor"></span><span class="preprocessor">#ifdef WRITE_LUTS</span>
03651 <span class="preprocessor"></span>        <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03652         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03653         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a6">LOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03654         WriteLut2File( <span class="stringliteral">"\pFINAL E Lut"</span>,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>, 'ELUT');
03655         WriteLut2File( <span class="stringliteral">"\pFINAL A Lut"</span>,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>, 'ALUT');
03656         WriteLut2File( <span class="stringliteral">"\pFINAL X Lut"</span>,theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>, 'XLUT');
03657         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03658         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03659         <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a7">UNLOCK_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03660 <span class="preprocessor">#endif</span>
03661 <span class="preprocessor"></span>        <span class="comment">/*------------------------ save all results...*/</span>
03662         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
03663         {
03664 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03665 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
03666                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" ERROR: theLutData.inputLut == nil\n"</span>);
03667 <span class="preprocessor">#endif</span>
03668 <span class="preprocessor"></span>        } <span class="keywordflow">else</span>
03669         {
03670                 (CMSession)-&gt;lutParam.inputLut = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>;                                                                                           <span class="comment">/* E lut */</span>
03671                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;      
03672         }
03673         
03674         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
03675         {
03676 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03677 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
03678                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" ERROR: theLutData.outputLut == nil\n"</span>);
03679 <span class="preprocessor">#endif</span>
03680 <span class="preprocessor"></span>        } <span class="keywordflow">else</span>
03681         {
03682                 (CMSession)-&gt;lutParam.outputLut = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>;                                                                                 <span class="comment">/* A lut */</span>
03683                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;     
03684         }
03685         
03686         <span class="keywordflow">if</span> (theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> == <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>)
03687         {
03688 <span class="preprocessor">#ifdef DEBUG_OUTPUT</span>
03689 <span class="preprocessor"></span>                <span class="keywordflow">if</span> ( DebugCheck(kThisFile, kDebugErrorInfo) )
03690                         <a class="code" href="../../d7/d2/drivesup_8c.html#a0">DebugPrint</a>(<span class="stringliteral">" ERROR: theLutData.colorLut == nil\n"</span>);
03691 <span class="preprocessor">#endif</span>
03692 <span class="preprocessor"></span>        } <span class="keywordflow">else</span>
03693         {
03694                 (CMSession)-&gt;lutParam.colorLut = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>;                                                                                           <span class="comment">/* X lut */</span>
03695                 theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a> = <a class="code" href="../../d4/d6/lh__open_2pi__basic_8h.html#a2">nil</a>;      
03696         }
03697         
03698         (CMSession)-&gt;lutParam.colorLutInDim                     = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o6">colorLutInDim</a>;
03699         (CMSession)-&gt;lutParam.colorLutOutDim            = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o7">colorLutOutDim</a>;
03700         (CMSession)-&gt;lutParam.colorLutGridPoints        = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o8">colorLutGridPoints</a>;
03701         (CMSession)-&gt;lutParam.colorLutWordSize          = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o9">colorLutWordSize</a>;
03702         (CMSession)-&gt;lutParam.inputLutWordSize          = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o1">inputLutWordSize</a>;
03703         (CMSession)-&gt;lutParam.outputLutWordSize         = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o4">outputLutWordSize</a>;
03704         (CMSession)-&gt;lutParam.inputLutEntryCount        = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o0">inputLutEntryCount</a>;
03705         (CMSession)-&gt;lutParam.outputLutEntryCount       = theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o3">outputLutEntryCount</a>;
03706         
03707         <span class="comment">/* ---------------------------------------------------------------------------------</span>
03708 <span class="comment">            clean up &amp; exit</span>
03709 <span class="comment">           ---------------------------------------------------------------------------------*/</span>
03710 CleanupAndExit:
03711         newProfileSet = (<a class="code" href="../../d4/d8/structLHConcatProfileSet.html">LHConcatProfileSet</a> *)<a class="code" href="../../d9/d7/w98_2lh__open_2pi__mem_8h.html#a4">DisposeIfPtr</a>((Ptr)newProfileSet);
03712         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>             = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o2">inputLut</a>);
03713         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>    = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o5">outputLut</a>);
03714         theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>             = <a class="code" href="../../d5/d6/lh__core_2defines_8h.html#a10">DISPOSE_IF_DATA</a>(theLutData.<a class="code" href="../../d0/d4/structCMLutParam.html#o10">colorLut</a>);
03715 
03716         <a class="code" href="../../d6/d9/lh__open_2general_8h.html#a2">LH_END_PROC</a>(<span class="stringliteral">"PrepareCombiLUTs"</span>)
03717         return err;
03718 }
</div></pre>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sat May 15 19:43:51 2004 for test by
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
